
<!DOCTYPE html>
<html lang="zh-tw">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="我是山姆鍋">
    <title>在 Ubuntu 上部署適合上線的單機 NodeBB 論壇服務 - 我是山姆鍋</title>
    <meta name="author" content="Sampot (山姆鍋)">
    
    
        <link rel="icon" href="https://samkuo.me/images/favicon.png">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","https://tw.linkedin.com/in/sampot","https://developers.tw/@山姆鍋","/sitemap/"],"image":"logo.png"},"articleBody":"本文山姆鍋分享如何安裝與設定一個 NodeBB 論壇的正式生產環境 (production environment)。由於整個環境不只包含 NodeBB 本身，會從主機系統的開始設定開始到 Nginx web 服務。安裝過程參考了多篇文章，對於特定元件的安裝細節會直接連結到對應的教學文章，本文盡量只做重點說明。\n \n歡迎您加入 #Developers.TW ，A.K.A. ＃呆丸開發者。\n\n安裝目標\n本文是以 #Developers.TW 作為實際案例，並以符合需求的最少安裝為目標。選擇性的元件，如 iframely 網頁內嵌剖析或者 Solr 搜尋服務並不在本文說明。因為目標是可用在正式上線的最小安裝，擴充性、可用性等等自然也就先不要求了。\n下圖是部署完成後粗略的系統架構圖：\n\n準備工作\n底下是一些 NodeBB 論壇安裝設定需要的前置需求：\n\n有 NodeBB 論壇的專屬域名或子域名，像 #Developers.TW 的域名是 developers.tw。\n域名服務器已經設定完畢。本文是採用 CloudFlare 作為 DNS 以及 CDN 服務供應商。\n讀者知道如何設定域名的 DNS 紀錄。\n部署使用的工作機 (筆電或者 PC) 已經有 SSH 登入的金鑰對 (key pair)。\n\n主機系統\n對於經濟實惠又需要完整系統的部署環境，山姆鍋通常都會選用 DigitalOcean 的 VPS 虛擬私有伺服器，這次也不例外，選用一個標準型 1GB 記憶體、1 核 vCPU 的 Droplet 作為部署環境。\n註冊 DigitalOcean 帳戶以及建立一個 Droplet 可以參考 Digital Ocean: 申請自己的虛擬主機伺服器。\n基本環境 (Ubuntu 18.04)\n\n\n\n項目\n方案\n\n\n\n\n主機環境\n DigitalOcean Droplet\n\n\n 主機組態\n 1 core vCPU, 1GB RAM, 25GB SSD\n\n\n 作業系統\n Ubuntu 18.04 64-bit\n\n\n\n郵件寄送\n強烈建議使用雲端電子信件寄送服務，不要在主機自行安裝 Postfix, Exim 等郵件軟體。現在雲端郵件寄送服務功能完整、成功送達率較高，又有每月免費使用額度。#Developers.TW 使用的是 SendGrid 提供的郵寄服務，只是因為山姆鍋有使用經驗，讀者可以選擇自己熟悉的服務。\n不管採用哪個服務，需要取得下列郵件寄送服務的網路參數：\n\n\n\n項目\n說明\n\n\n\n\n SMTP 伺服器位址\n IP 或域名\n\n\n SMTP 監聽埠\n如 487\n\n\nSMTP 登入名稱\n SendGrid 使用 ‘apikey’ 作為登入名稱\n\n\n SMTP 登入密碼\n從 SendGrid 申請的 api key 內容\n\n\n\n有了雲端郵件寄送服務後，要讓主機系統可以寄出信件，尚須安裝與設定下列套件：\n\nmailutils\nssmtp\n\n使用下列指令安裝：\n1$ sudo apt-get install mailutils ssmtp\n\b\bssmtp 需要根據雲端郵寄服務提供的網路參數來設定，底下是 /etc/ssmtp/ssmtp.conf 檔案的內容：\n12345678910111213141516171819202122232425262728## Config file for sSMTP sendmail## The person who gets all mail for userids &lt; 1000# Make this empty to disable rewriting.root=sam@example.com   # 管理者的 email# The place where the mail goes. The actual machine name is required no # MX records are consulted. Commonly mailhosts are named mail.domain.commailhub=smtp.sendgrid.net:587 # 雲端郵件寄送服務提供接口# Where will the mail seem to come from?#rewriteDomain=rewriteDomain=developers.tw  ＃改寫收件人看到的郵件來源域名# The full hostnamehostname=nodebb-test   ＃ 主機名稱# Are users allowed to set their own From: address?# YES - Allow the user to specify their own From: address# NO - Use the system generated From: address#FromLineOverride=YESAuthUser=apikey             # SMTP 登入名稱AuthPass=xxxxxxxxxx         # SMTP 登入密碼UseSTARTTLS=YESUseTLS=YES\n餐考文章：\n\nLinux 使用 SSMTP 與 GMail 以指令或程式自動寄信教學 。\n\n安全強化\n完成主機系統的基本安裝後，作為網路服務主機，主機安全性也不容輕忽。\nSSH\n底下是一些安全強化重點 (只是基本):\n\n只允許使用憑證 SSH 遠端登入主機，禁用密碼。\nSSH 不允許直接以 root 帳戶登入。\n(選擇性) 更改 SSH 服務的監聽埠 (port)，例如：939：這個不會增加多少安全性，但可以有效減少系統日誌的被攻擊的紀錄。\n\n參考文章：\n\nBest practices for hardening new sever in 2017\n\n\n自動更新安全修補\n當主機系統被發現有安全漏洞時，山姆鍋希望能夠自動更新修補程式。採考此文章 How To Setup And Enable Automatic Security Updates On Ubuntu 。\n安裝 unattended-upgrade 套件\n使用下列指令安裝 unattended-upgrade 套件：\n1$ sudo apt install unattended-upgrades\nunattended-upgrades 的設定檔為 /etc/apt/apt.conf.d/50unattended-upgrades，山姆鍋直接使用預設值。如果需要增加自動更新的套件庫 (repository)，可以用文字編輯器修改此文件，移除對應行前 // 註解符號。\n12345678910111213Unattended-Upgrade::Allowed-Origins {        \"${distro_id}:${distro_codename}\";  \"${distro_id}:${distro_codename}-security\";  // Extended Security Maintenance; doesn't necessarily exist for  // every release and this system may not have it installed, but if  // available, the policy for updates is such that unattended-upgrades  // should also install from here by default.  \"${distro_id}ESMApps:${distro_codename}-apps-security\";  \"${distro_id}ESM:${distro_codename}-infra-security\";  //\t\"${distro_id}:${distro_codename}-updates\";  //\t\"${distro_id}:${distro_codename}-proposed\";  //\t\"${distro_id}:${distro_codename}-backports\";};\n啟用自動更新\n/etc/apt/apt.conf.d/20auto-upgrades 設定檔控制系統自動更新的行為。\n123APT::Periodic::Update-Package-Lists \"1\";APT::Periodic::Unattended-Upgrade \"1\";APT::Periodic::AutocleanInternal \"7\";\n其中，“1” 表示啟用，要禁用則改為 “0”。\n測試自動更新\n使用下列指令進行空轉測試：\n1sudo unattended-upgrades --dry-run -–debug\n會顯示類似下面的結果：\n123456789... 前面省略adjusting candidate version: python3-zope.interface=4.3.2-1build2pkgs that look like they should be upgraded: Fetched 0 B in 0sfetch.run() result: 0blacklist: []whitelist: []No packages found that can be upgraded unattended and no pending auto-removals\n啟用防火牆\n不少雲端基礎服務商，如 DigitalOcean, 都有提供雲端防火牆，如果是多台主機的情況下，使用雲端防火牆比較方便。以本文的單一主機來說，直接使用 Ubuntu 內建的 ufw 來提供簡易主機防火牆。\n1234ufw allow 80ufw allow 443ufw allow sshufw enable\n其中，假如 SSH 服務的監聽埠不是預設的 22 的話，要把 ssh 改成對應的埠號。\n注意：不開啟 NodeBB 的 4567, 這個只允許從本機 (localhost) 連線\n資料庫安裝 (Redis)\n直接安裝系統預設的 Redis 套件，使用下列指令安裝：\n1$ sudo apt-get install -y redis-server\n安裝後，為了讓 Redis 服務開機時自動啟動需要執行下列指令：\n1$ sudo systemctl enable redis.service\nRedis 是作為 NodeBB 的主資料庫，所以資料持久性 (persistence) 需要特別設定以減少系統不正常當機時資料遺失的風險。為了這個目的，啟用 Redis 的 append-only log，底下是 append-only log 以及幾個相關的設定值 (檔案 /etc/redis/redis.conf)：\n1234daemonize yessupervised systemdrequirepass dsfjklewreriier    # redis 客戶端連線密碼，請不要直接套用，讀者需自訂。appendonly yes\n讀者需要將設定項目改成對應的設定值。\n設定修改完成後，使用下列指令重啟 Redis:\n1$ sudo systemctl restart redis.service\nRedis 安裝可參考 如何在 Ubuntu 18.04 上安裝和配置 Redis 。\nWeb 安全憑證 (Let’s Encrypt)\nWeb 伺服器憑證是伺服器域名的身分證明，需要向一個 CA 組織申請核發，Let’s Encrypt 是個免費且受歡迎的 CA。\n由於 Let’s Encrypt 已經支援 wildcard 域名憑證，本文使用 DNS 認證機制來申請 wildcard 憑證。\n參考下列文章安裝 certbot 進行申請憑證:\n\n\nInstall Let’s Encrypt Free SSL Wildcard Certificate on ubuntu 18\n\n\nLet’s Encrypt Wildcard SSL nginx for WordPress Ubuntu 18.04\n\n\n因為希望憑證同時支援裸域名 (developers.tw) 以及子域名 (*.developers.tw)，申請指令要稍微修改\n1sudo certbot --server https://acme-v02.api.letsencrypt.org/directory -d *.developers.tw -d developers.tw --manual --preferred-challenges dns-01 certonly\n按照畫面指示新增指定名稱的 DNS TXT 紀錄並進行驗證，如通過憑證檔案位於 /etc/letsencrpyt 目錄。\nWeb 服務 (Nginx)\nWeb 服務有下列目的：\n\n作為 NodeBB 負載均衡器 (load balancer)。\n支援 TLS/SSL 網路加密結定。\n服務 NodeBB 靜態檔案資源。\n\n#Developers.TW 使用 Nginx 作為 web 服務軟體。\n安裝 Nginx 套件\n1$ sudo apt-get install -y nginx\n設定 Nginx\n本文的安裝，NodeBB 服務只接受本地 (127.0.0.1) 連線，監聽埠是 4567。底下將 Nginx 設為 NodeBB 服務的代理伺服器。\n新增 /etc/nginx/sites-available/developers.tw，檔案內容如下：\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192upstream backend {  server 127.0.0.1:4567;}server {  listen 80;  access_log  off;  error_log   off;  server_name developers.tw www.developers.tw;  return 301 https://developers.tw$request_uri;}server {  listen 443 ssl;  listen [::]:443 ssl;  access_log  off;  error_log   off;  server_name www.developers.tw;  ssl on;  ssl_certificate /etc/letsencrypt/live/developers.tw/fullchain.pem; # managed by Certbot  ssl_certificate_key /etc/letsencrypt/live/developers.tw/privkey.pem; # managed by Certbot  return 301 https://developers.tw$request_uri;}server {  listen 443 ssl http2;  listen [::]:443 ssl http2;  error_log /var/log/nginx/developers.tw-error.log;  access_log /var/log/nginx/developers.tw-access.log;  server_name developers.tw;  root /opt/nodebb/public;  index index.html;  gzip            on;  gzip_min_length 1000;  gzip_proxied    off;  gzip_types      text/plain application/xml text/javascript application/javascript application/x-javascript text/css application/json;  ssl on;  ssl_stapling on;  ssl_stapling_verify on;  ssl_certificate /etc/letsencrypt/live/developers.tw/fullchain.pem; # managed by Certbot  ssl_certificate_key /etc/letsencrypt/live/developers.tw/privkey.pem; # managed by Certbot  ssl_protocols TLSv1.1 TLSv1.2;  ssl_prefer_server_ciphers on;  ssl_ciphers \"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH\";  ssl_session_cache shared:SSL:10m;  proxy_set_header X-Real-IP $remote_addr;  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  proxy_set_header X-Forwarded-Proto $scheme;  proxy_set_header Host $http_host;  proxy_set_header X-NginX-Proxy true;  proxy_redirect off;  # Socket.IO Support  proxy_http_version 1.1;  proxy_set_header Upgrade $http_upgrade;  proxy_set_header Connection \"upgrade\";  location @backend {        proxy_pass http://backend;  }  location ~ ^/assets/(.*) {    root /opt/nodebb/;    try_files /build/public/$1 /public/$1 @backend;  }  location /plugins/ {    root /opt/nodebb/build/public/;    try_files $uri @backend;  }location / {  proxy_pass http://backend;}}\n同樣地，developers.tw 需要更換為論壇實際使用的域名。\n除了來自 NodeBB 官方文件的建議設定外，也設定了強制將 www.developers.tw 轉址為 developers.tw，且 http 協定轉成 `https’，也就是說：只接受 HTTPS 連線。\n啟用 NodeBB 的站點\n123$ sudo ln -s /etc/nginx/sites-available/developers.tw /etc/nginx/sites-enabled/$ sudo nginx -t$ sudo systemctl restart nginx\n到這個步驟，沒問題的話可以使用瀏覽器連線到 https://developers.tw , 但因為後端的 NodeBB 還沒啟用，網頁會出現 503 錯誤。\n執行環境安裝 (NodeJS)\nNodeJS 以及 NodeBB 的安裝都是參考這篇文章 How To: Install NodeBB on DigitalOcean/Ubuntu 18.04 。\n使用下列指令安裝 NodeJS：\n123$ sudo curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -$ sudo apt update$ sudo apt install nodejs -y\n應用服務安裝 (NodeBB)\n新增 nodebb 帳戶\n為了權限控管，NodeBB 服務使用 nodebb 帳戶執行。使用下列指令新增帳戶：\n1$ sudo adduser nodebb\n複製 NodeBB 原始程式\n1234$ cd /opt$ sudo git clone https://github.com/NodeBB/NodeBB.git nodebb$ sudo chown -R nodebb:nodebb ./nodebb$ sudo su - nodebb\n初始設定 NodeBB\n12\b\b$ cd /opt/nodebb\b$ ./nodebb setup\n./nodebb setup 會詢問一系列問題，除下列外其餘使用預設值：\n\n\n\n項目\n設定值\n\n\n\n\n url\nhttps://developers.tw\n\n\ndatabase\n 選擇 redis\n\n\nredis password\n 在資料庫安裝 (Redis) 章節中，requirepass 的設定值\n\n\n\nurl 需要根據實際的域名做修改，上面範例是 #Developers.TW 的域名。\n讓 NodeBB 隨系統自動啟動\n使用文字編輯器新增 / 修改檔案 /etc/systemd/system/nodebb.service，內容為：\n12345678910111213141516171819[Unit]Description=NodeBBDocumentation=https://docs.nodebb.orgAfter=system.slice multi-user.target redis.service[Service]Type=forkingUser=nodebbStandardOutput=syslogStandardError=syslogSyslogIdentifier=nodebbWorkingDirectory=/opt/nodebbExecStart=/usr/bin/node loader.jsRestart=always[Install]WantedBy=multi-user.target\n123$ sudo systemctl daemon-reload$ sudo systemctl enable nodebb.service$ sudo systemctl start nodebb.service\n啟動完成後，就可以開啟瀏覽器連到 https://developers.tw/admin , 登入控制台進行 NodeBB 的管理與設定。\n小結\n經過冗長的來來回回步驟後，終於有個可以上線的部署環境。但有了基本部署環境，NodeBB 還要根據需要進行設定與客製化，這個才是重中之重。NodeBB 的設定可以參考 官方的文件，而 NodeBB 的進階功能，不少需要額外申請雲端服務 (如 Facebook SSO) 或者安裝軟體 (如 Solr 等)，讀者可視目的來決定是否有需要。\n","dateCreated":"2020-03-22T14:00:59+08:00","dateModified":"2020-03-23T10:37:15+08:00","datePublished":"2020-03-22T14:00:59+08:00","description":"本文山姆鍋分享如何安裝與設定一個 NodeBB 論壇的正式生產環境 (production environment)。由於整個環境不只包含 NodeBB 本身，會從主機系統的開始設定開始到 Nginx web 服務。安裝過程參考了多篇文章，對於特定元件的安裝細節會直接連結到對應的教學文章，本文盡量只做重點說明。","headline":"在 Ubuntu 上部署適合上線的單機 NodeBB 論壇服務","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"},"publisher":{"@type":"Organization","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","https://tw.linkedin.com/in/sampot","https://developers.tw/@山姆鍋","/sitemap/"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/","keywords":"Ubuntu, nodebb, digitalocean, redis, nodejs, iframely, solr"}</script>
    <meta name="description" content="本文山姆鍋分享如何安裝與設定一個 NodeBB 論壇的正式生產環境 (production environment)。由於整個環境不只包含 NodeBB 本身，會從主機系統的開始設定開始到 Nginx web 服務。安裝過程參考了多篇文章，對於特定元件的安裝細節會直接連結到對應的教學文章，本文盡量只做重點說明。">
<meta property="og:type" content="blog">
<meta property="og:title" content="在 Ubuntu 上部署適合上線的單機 NodeBB 論壇服務">
<meta property="og:url" content="https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/">
<meta property="og:site_name" content="我是山姆鍋">
<meta property="og:description" content="本文山姆鍋分享如何安裝與設定一個 NodeBB 論壇的正式生產環境 (production environment)。由於整個環境不只包含 NodeBB 本身，會從主機系統的開始設定開始到 Nginx web 服務。安裝過程參考了多篇文章，對於特定元件的安裝細節會直接連結到對應的教學文章，本文盡量只做重點說明。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/nodebb-deployment.jpg">
<meta property="article:published_time" content="2020-03-22T06:00:59.000Z">
<meta property="article:modified_time" content="2020-03-23T02:37:15.282Z">
<meta property="article:author" content="Sampot (山姆鍋)">
<meta property="article:tag" content="Ubuntu">
<meta property="article:tag" content="nodebb">
<meta property="article:tag" content="digitalocean">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="nodejs">
<meta property="article:tag" content="iframely">
<meta property="article:tag" content="solr">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/nodebb-deployment.jpg">
<meta name="twitter:creator" content="@sampotkuo">
<meta property="fb:app_id" content="1538037013031361">
    
    
        
    
    <meta property="og:image" content="https://samkuo.me/images/featured_image.jpg"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-lfspghztdttlloh4nly9hmp3cqmehlzaagf5ften7wo63faxiltzljjm4fb0.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41152700-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-41152700-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
        <img class="header-avatar-picture" src="/images/logo32.png" alt="作者的圖片" />
            我是山姆鍋
        </a>
    </div>
    
        
            <a
                class="header-right-icon open-algolia-search"
                href="#search"
                aria-label="打開鏈接: /#search"
            >
        
        
            <i class="fa fa-search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/images/logo.png" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Sampot (山姆鍋)</h4>
                
                    <h5 class="sidebar-profile-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about/"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/sampot"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://tw.linkedin.com/in/sampot"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://developers.tw/@山姆鍋"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="聯絡"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">聯絡</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/sitemap/"
                            
                            rel="noopener"
                            title="網站導覽"
                        >
                        <i class="sidebar-button-icon fa fa-sitemap" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">網站導覽</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            在 Ubuntu 上部署適合上線的單機 NodeBB 論壇服務
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-03-22T14:00:59+08:00">
	
		    3月 22, 2020
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <div class="alert info no-icon">
                <a href="https://www.facebook.com/sampotkuo" target="_blank" rel="noopener">「我是山姆鍋」有臉書專頁</a>
            </div>

            <p>本文山姆鍋分享如何安裝與設定一個 NodeBB 論壇的正式生產環境 (production environment)。由於整個環境不只包含 NodeBB 本身，會從主機系統的開始設定開始到 Nginx web 服務。安裝過程參考了多篇文章，對於特定元件的安裝細節會直接連結到對應的教學文章，本文盡量只做重點說明。</p>
 <a id="more"></a>
<div class="alert info no-icon"><p>歡迎您加入 <a href="https://developers.tw" target="_blank" rel="noopener">#Developers.TW</a> ，A.K.A. ＃呆丸開發者。</p>
</div>
<h2 id="安裝目標">安裝目標</h2>
<p>本文是以 <a href="https://developers.tw" target="_blank" rel="noopener">#Developers.TW</a> 作為實際案例，並以符合需求的最少安裝為目標。選擇性的元件，如 iframely 網頁內嵌剖析或者 Solr 搜尋服務並不在本文說明。因為目標是可用在正式上線的最小安裝，擴充性、可用性等等自然也就先不要求了。</p>
<p>下圖是部署完成後粗略的系統架構圖：</p>
<div class="figure " style="width:;"><a class="fancybox" href="nodebb-deployment.jpg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="nodebb-deployment.jpg" alt=""></a></div>
<h2 id="準備工作">準備工作</h2>
<p>底下是一些 NodeBB 論壇安裝設定需要的前置需求：</p>
<ol>
<li>有 NodeBB 論壇的專屬域名或子域名，像 #<a href="http://Developers.TW" target="_blank" rel="noopener">Developers.TW</a> 的域名是 <a href="http://developers.tw" target="_blank" rel="noopener">developers.tw</a>。</li>
<li>域名服務器已經設定完畢。本文是採用 CloudFlare 作為 DNS 以及 CDN 服務供應商。</li>
<li>讀者知道如何設定域名的 DNS 紀錄。</li>
<li>部署使用的工作機 (筆電或者 PC) 已經有 SSH 登入的金鑰對 (key pair)。</li>
</ol>
<h2 id="主機系統">主機系統</h2>
<p>對於經濟實惠又需要完整系統的部署環境，山姆鍋通常都會選用 DigitalOcean 的 VPS 虛擬私有伺服器，這次也不例外，選用一個標準型 1GB 記憶體、1 核 vCPU 的 Droplet 作為部署環境。</p>
<p>註冊 DigitalOcean 帳戶以及建立一個 Droplet 可以參考 <a href="https://cyku.tw/digital-ocean/" target="_blank" rel="noopener">Digital Ocean: 申請自己的虛擬主機伺服器</a>。</p>
<h3 id="基本環境-Ubuntu-18-04">基本環境 (Ubuntu 18.04)</h3>
<table>
<thead>
<tr>
<th>項目</th>
<th>方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>主機環境</td>
<td> DigitalOcean Droplet</td>
</tr>
<tr>
<td> 主機組態</td>
<td> 1 core vCPU, 1GB RAM, 25GB SSD</td>
</tr>
<tr>
<td> 作業系統</td>
<td> Ubuntu 18.04 64-bit</td>
</tr>
</tbody>
</table>
<h3 id="郵件寄送">郵件寄送</h3>
<p>強烈建議使用雲端電子信件寄送服務，不要在主機自行安裝 Postfix, Exim 等郵件軟體。現在雲端郵件寄送服務功能完整、成功送達率較高，又有每月免費使用額度。#<a href="http://Developers.TW" target="_blank" rel="noopener">Developers.TW</a> 使用的是 SendGrid 提供的郵寄服務，只是因為山姆鍋有使用經驗，讀者可以選擇自己熟悉的服務。</p>
<p>不管採用哪個服務，需要取得下列郵件寄送服務的網路參數：</p>
<table>
<thead>
<tr>
<th>項目</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td> SMTP 伺服器位址</td>
<td> IP 或域名</td>
</tr>
<tr>
<td> SMTP 監聽埠</td>
<td>如 487</td>
</tr>
<tr>
<td>SMTP 登入名稱</td>
<td> SendGrid 使用 ‘apikey’ 作為登入名稱</td>
</tr>
<tr>
<td> SMTP 登入密碼</td>
<td>從 SendGrid 申請的 api key 內容</td>
</tr>
</tbody>
</table>
<p>有了雲端郵件寄送服務後，要讓主機系統可以寄出信件，尚須安裝與設定下列套件：</p>
<ul>
<li>mailutils</li>
<li>ssmtp</li>
</ul>
<p>使用下列指令安裝：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install mailutils ssmtp</span><br></pre></td></tr></tbody></table></figure>
<p>ssmtp 需要根據雲端郵寄服務提供的網路參數來設定，底下是 <code>/etc/ssmtp/ssmtp.conf</code> 檔案的內容：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># Config file for sSMTP sendmail</span><br><span class="line">#</span><br><span class="line"># The person who gets all mail for userids &lt; 1000</span><br><span class="line"># Make this empty to disable rewriting.</span><br><span class="line">root=sam@example.com   # 管理者的 email</span><br><span class="line"></span><br><span class="line"># The place where the mail goes. The actual machine name is required no </span><br><span class="line"># MX records are consulted. Commonly mailhosts are named mail.domain.com</span><br><span class="line">mailhub=smtp.sendgrid.net:587 # 雲端郵件寄送服務提供接口</span><br><span class="line"></span><br><span class="line"># Where will the mail seem to come from?</span><br><span class="line">#rewriteDomain=</span><br><span class="line">rewriteDomain=developers.tw  ＃改寫收件人看到的郵件來源域名</span><br><span class="line"></span><br><span class="line"># The full hostname</span><br><span class="line">hostname=nodebb-test   ＃ 主機名稱</span><br><span class="line"></span><br><span class="line"># Are users allowed to set their own From: address?</span><br><span class="line"># YES - Allow the user to specify their own From: address</span><br><span class="line"># NO - Use the system generated From: address</span><br><span class="line">#FromLineOverride=YES</span><br><span class="line"></span><br><span class="line">AuthUser=apikey             # SMTP 登入名稱</span><br><span class="line">AuthPass=xxxxxxxxxx         # SMTP 登入密碼</span><br><span class="line"></span><br><span class="line">UseSTARTTLS=YES</span><br><span class="line">UseTLS=YES</span><br></pre></td></tr></tbody></table></figure>
<p>餐考文章：</p>
<ul>
<li><a href="https://blog.gtwang.org/linux/linux-send-mail-command-using-ssmtp-and-gmail/" target="_blank" rel="noopener">Linux 使用 SSMTP 與 GMail 以指令或程式自動寄信教學</a> 。</li>
</ul>
<h3 id="安全強化">安全強化</h3>
<p>完成主機系統的基本安裝後，作為網路服務主機，主機安全性也不容輕忽。</p>
<h4 id="SSH">SSH</h4>
<p>底下是一些安全強化重點 (只是基本):</p>
<ol>
<li>只允許使用憑證 SSH 遠端登入主機，禁用密碼。</li>
<li>SSH 不允許直接以 root 帳戶登入。</li>
<li>(選擇性) 更改 SSH 服務的監聽埠 (port)，例如：939：這個不會增加多少安全性，但可以有效減少系統日誌的被攻擊的紀錄。</li>
</ol>
<p>參考文章：</p>
<ul>
<li><a href="https://www.digitalocean.com/community/questions/best-practices-for-hardening-new-sever-in-2017" target="_blank" rel="noopener">Best practices for hardening new sever in 2017</a></li>
<li></li>
</ul>
<h4 id="自動更新安全修補">自動更新安全修補</h4>
<p>當主機系統被發現有安全漏洞時，山姆鍋希望能夠自動更新修補程式。採考此文章 <a href="https://phoenixnap.com/kb/automatic-security-updates-ubuntu" target="_blank" rel="noopener">How To Setup And Enable Automatic Security Updates On Ubuntu</a> 。</p>
<h3 id="安裝-unattended-upgrade-套件">安裝 unattended-upgrade 套件</h3>
<p>使用下列指令安裝 unattended-upgrade 套件：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install unattended-upgrades</span><br></pre></td></tr></tbody></table></figure>
<p><code>unattended-upgrades</code> 的設定檔為 <code>/etc/apt/apt.conf.d/50unattended-upgrades</code>，山姆鍋直接使用預設值。如果需要增加自動更新的套件庫 (repository)，可以用文字編輯器修改此文件，移除對應行前 <code>//</code> 註解符號。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Unattended-Upgrade::Allowed-Origins {</span><br><span class="line">        <span class="string">"<span class="variable">${distro_id}</span>:<span class="variable">${distro_codename}</span>"</span>;</span><br><span class="line">  <span class="string">"<span class="variable">${distro_id}</span>:<span class="variable">${distro_codename}</span>-security"</span>;</span><br><span class="line">  // Extended Security Maintenance; doesn<span class="string">'t necessarily exist for</span></span><br><span class="line"><span class="string">  // every release and this system may not have it installed, but if</span></span><br><span class="line"><span class="string">  // available, the policy for updates is such that unattended-upgrades</span></span><br><span class="line"><span class="string">  // should also install from here by default.</span></span><br><span class="line"><span class="string">  "${distro_id}ESMApps:${distro_codename}-apps-security";</span></span><br><span class="line"><span class="string">  "${distro_id}ESM:${distro_codename}-infra-security";</span></span><br><span class="line"><span class="string">  //	"${distro_id}:${distro_codename}-updates";</span></span><br><span class="line"><span class="string">  //	"${distro_id}:${distro_codename}-proposed";</span></span><br><span class="line"><span class="string">  //	"${distro_id}:${distro_codename}-backports";</span></span><br><span class="line"><span class="string">};</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="啟用自動更新">啟用自動更新</h3>
<p><code>/etc/apt/apt.conf.d/20auto-upgrades</code> 設定檔控制系統自動更新的行為。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">APT::Periodic::Update-Package-Lists "1";</span><br><span class="line">APT::Periodic::Unattended-Upgrade "1";</span><br><span class="line">APT::Periodic::AutocleanInternal "7";</span><br></pre></td></tr></tbody></table></figure>
<p>其中，“1” 表示啟用，要禁用則改為 “0”。</p>
<h3 id="測試自動更新">測試自動更新</h3>
<p>使用下列指令進行空轉測試：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo unattended-upgrades --dry-run -–debug</span><br></pre></td></tr></tbody></table></figure>
<p>會顯示類似下面的結果：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">... 前面省略</span><br><span class="line"></span><br><span class="line">adjusting candidate version: python3-zope.interface=4.3.2-1build2</span><br><span class="line">pkgs that look like they should be upgraded: </span><br><span class="line">Fetched 0 B <span class="keyword">in</span> 0s</span><br><span class="line">fetch.run() result: 0</span><br><span class="line">blacklist: []</span><br><span class="line">whitelist: []</span><br><span class="line">No packages found that can be upgraded unattended and no pending auto-removals</span><br></pre></td></tr></tbody></table></figure>
<h4 id="啟用防火牆">啟用防火牆</h4>
<p>不少雲端基礎服務商，如 DigitalOcean, 都有提供雲端防火牆，如果是多台主機的情況下，使用雲端防火牆比較方便。以本文的單一主機來說，直接使用 Ubuntu 內建的 ufw 來提供簡易主機防火牆。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ufw allow 80</span><br><span class="line">ufw allow 443</span><br><span class="line">ufw allow ssh</span><br><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></tbody></table></figure>
<p>其中，假如 SSH 服務的監聽埠不是預設的 22 的話，要把 <code>ssh</code> 改成對應的埠號。</p>
<p><em>注意：不開啟 NodeBB 的 4567, 這個只允許從本機 (localhost) 連線</em></p>
<h2 id="資料庫安裝-Redis">資料庫安裝 (Redis)</h2>
<p>直接安裝系統預設的 Redis 套件，使用下列指令安裝：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y redis-server</span><br></pre></td></tr></tbody></table></figure>
<p>安裝後，為了讓 Redis 服務開機時自動啟動需要執行下列指令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> redis.service</span><br></pre></td></tr></tbody></table></figure>
<p>Redis 是作為 NodeBB 的主資料庫，所以資料持久性 (persistence) 需要特別設定以減少系統不正常當機時資料遺失的風險。為了這個目的，啟用 Redis 的 append-only log，底下是 append-only log 以及幾個相關的設定值 (檔案 /etc/redis/redis.conf)：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">supervised systemd</span><br><span class="line">requirepass dsfjklewreriier    # redis 客戶端連線密碼，請不要直接套用，讀者需自訂。</span><br><span class="line">appendonly yes</span><br></pre></td></tr></tbody></table></figure>
<p>讀者需要將設定項目改成對應的設定值。</p>
<p>設定修改完成後，使用下列指令重啟 Redis:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart redis.service</span><br></pre></td></tr></tbody></table></figure>
<p>Redis 安裝可參考 <a href="https://www.itread01.com/content/1545078980.html" target="_blank" rel="noopener">如何在 Ubuntu 18.04 上安裝和配置 Redis</a> 。</p>
<h2 id="Web-安全憑證-Let’s-Encrypt">Web 安全憑證 (Let’s Encrypt)</h2>
<p>Web 伺服器憑證是伺服器域名的身分證明，需要向一個 CA 組織申請核發，Let’s Encrypt 是個免費且受歡迎的 CA。<br>
由於 Let’s Encrypt 已經支援 wildcard 域名憑證，本文使用 DNS 認證機制來申請 wildcard 憑證。</p>
<p>參考下列文章安裝 certbot 進行申請憑證:</p>
<ul>
<li>
<p><a href="https://medium.com/@lakin.mohapatra/generate-lets-encrypt-free-wildcard-certificate-on-ubuntu-18-dcf26f458e13" target="_blank" rel="noopener">Install Let’s Encrypt Free SSL Wildcard Certificate on ubuntu 18</a></p>
</li>
<li>
<p><a href="https://guides.wp-bullet.com/lets-encrypt-wildcard-ssl-nginx-for-wordpress-ubuntu-18-04/" target="_blank" rel="noopener">Let’s Encrypt Wildcard SSL nginx for WordPress Ubuntu 18.04</a></p>
</li>
</ul>
<p>因為希望憑證同時支援裸域名 (<a href="http://developers.tw" target="_blank" rel="noopener">developers.tw</a>) 以及子域名 (*.developers.tw)，申請指令要稍微修改</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --server https://acme-v02.api.letsencrypt.org/directory -d *.developers.tw -d developers.tw --manual --preferred-challenges dns-01 certonly</span><br></pre></td></tr></tbody></table></figure>
<p>按照畫面指示新增指定名稱的 DNS TXT 紀錄並進行驗證，如通過憑證檔案位於 <code>/etc/letsencrpyt</code> 目錄。</p>
<h2 id="Web-服務-Nginx">Web 服務 (Nginx)</h2>
<p>Web 服務有下列目的：</p>
<ul>
<li>作為 NodeBB 負載均衡器 (load balancer)。</li>
<li>支援 TLS/SSL 網路加密結定。</li>
<li>服務 NodeBB 靜態檔案資源。</li>
</ul>
<p>#<a href="http://Developers.TW" target="_blank" rel="noopener">Developers.TW</a> 使用 Nginx 作為 web 服務軟體。</p>
<h3 id="安裝-Nginx-套件">安裝 Nginx 套件</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y nginx</span><br></pre></td></tr></tbody></table></figure>
<h3 id="設定-Nginx">設定 Nginx</h3>
<p>本文的安裝，NodeBB 服務只接受本地 (127.0.0.1) 連線，監聽埠是 4567。底下將 Nginx 設為 NodeBB 服務的代理伺服器。</p>
<p>新增 <code>/etc/nginx/sites-available/developers.tw</code>，檔案內容如下：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">upstream backend {</span><br><span class="line">  server 127.0.0.1:4567;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">server {</span><br><span class="line">  listen 80;</span><br><span class="line"></span><br><span class="line">  access_log  off;</span><br><span class="line">  error_log   off;</span><br><span class="line"></span><br><span class="line">  server_name developers.tw www.developers.tw;</span><br><span class="line"></span><br><span class="line">  return 301 https://developers.tw$request_uri;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">server {</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line"></span><br><span class="line">  access_log  off;</span><br><span class="line">  error_log   off;</span><br><span class="line"></span><br><span class="line">  server_name www.developers.tw;</span><br><span class="line"></span><br><span class="line">  ssl on;</span><br><span class="line">  ssl_certificate /etc/letsencrypt/live/developers.tw/fullchain.pem; # managed by Certbot</span><br><span class="line">  ssl_certificate_key /etc/letsencrypt/live/developers.tw/privkey.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">  return 301 https://developers.tw$request_uri;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">server {</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">  listen [::]:443 ssl http2;</span><br><span class="line"></span><br><span class="line">  error_log /var/log/nginx/developers.tw-error.log;</span><br><span class="line">  access_log /var/log/nginx/developers.tw-access.log;</span><br><span class="line"></span><br><span class="line">  server_name developers.tw;</span><br><span class="line"></span><br><span class="line">  root /opt/nodebb/public;</span><br><span class="line">  index index.html;</span><br><span class="line"></span><br><span class="line">  gzip            on;</span><br><span class="line">  gzip_min_length 1000;</span><br><span class="line">  gzip_proxied    off;</span><br><span class="line">  gzip_types      text/plain application/xml text/javascript application/javascript application/x-javascript text/css application/json;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ssl on;</span><br><span class="line">  ssl_stapling on;</span><br><span class="line">  ssl_stapling_verify on;</span><br><span class="line">  ssl_certificate /etc/letsencrypt/live/developers.tw/fullchain.pem; # managed by Certbot</span><br><span class="line">  ssl_certificate_key /etc/letsencrypt/live/developers.tw/privkey.pem; # managed by Certbot</span><br><span class="line">  ssl_protocols TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";</span><br><span class="line">  ssl_session_cache shared:SSL:10m;</span><br><span class="line"></span><br><span class="line">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">  proxy_set_header Host $http_host;</span><br><span class="line">  proxy_set_header X-NginX-Proxy true;</span><br><span class="line"></span><br><span class="line">  proxy_redirect off;</span><br><span class="line"></span><br><span class="line">  # Socket.IO Support</span><br><span class="line">  proxy_http_version 1.1;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection "upgrade";</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location @backend {</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  location ~ ^/assets/(.*) {</span><br><span class="line">    root /opt/nodebb/;</span><br><span class="line">    try_files /build/public/$1 /public/$1 @backend;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  location /plugins/ {</span><br><span class="line">    root /opt/nodebb/build/public/;</span><br><span class="line">    try_files $uri @backend;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location / {</span><br><span class="line">  proxy_pass http://backend;</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>同樣地，<code>developers.tw</code> 需要更換為論壇實際使用的域名。<br>
除了來自 NodeBB 官方文件的建議設定外，也設定了強制將 <code>www.developers.tw</code> 轉址為 <code>developers.tw</code>，且 <code>http</code> 協定轉成 `https’，也就是說：只接受 HTTPS 連線。</p>
<h3 id="啟用-NodeBB-的站點">啟用 NodeBB 的站點</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ln -s /etc/nginx/sites-available/developers.tw /etc/nginx/sites-enabled/</span><br><span class="line">$ sudo nginx -t</span><br><span class="line">$ sudo systemctl restart nginx</span><br></pre></td></tr></tbody></table></figure>
<p>到這個步驟，沒問題的話可以使用瀏覽器連線到 <a href="https://developers.tw" target="_blank" rel="noopener">https://developers.tw</a> , 但因為後端的 NodeBB 還沒啟用，網頁會出現 503 錯誤。</p>
<h2 id="執行環境安裝-NodeJS">執行環境安裝 (NodeJS)</h2>
<p>NodeJS 以及 NodeBB 的安裝都是參考這篇文章 <a href="https://blog.nodebb.org/how-to-install-nodebb-on-digitalocean-ubuntu-18-04/" target="_blank" rel="noopener">How To: Install NodeBB on DigitalOcean/Ubuntu 18.04</a> 。</p>
<p>使用下列指令安裝 NodeJS：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -</span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install nodejs -y</span><br></pre></td></tr></tbody></table></figure>
<h2 id="應用服務安裝-NodeBB">應用服務安裝 (NodeBB)</h2>
<h3 id="新增-nodebb-帳戶">新增 nodebb 帳戶</h3>
<p>為了權限控管，NodeBB 服務使用 nodebb 帳戶執行。使用下列指令新增帳戶：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser nodebb</span><br></pre></td></tr></tbody></table></figure>
<h3 id="複製-NodeBB-原始程式">複製 NodeBB 原始程式</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt</span><br><span class="line">$ sudo git <span class="built_in">clone</span> https://github.com/NodeBB/NodeBB.git nodebb</span><br><span class="line">$ sudo chown -R nodebb:nodebb ./nodebb</span><br><span class="line">$ sudo su - nodebb</span><br></pre></td></tr></tbody></table></figure>
<h3 id="初始設定-NodeBB">初始設定 NodeBB</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/nodebb</span><br><span class="line">$ ./nodebb setup</span><br></pre></td></tr></tbody></table></figure>
<p><code>./nodebb setup</code> 會詢問一系列問題，除下列外其餘使用預設值：</p>
<table>
<thead>
<tr>
<th>項目</th>
<th>設定值</th>
</tr>
</thead>
<tbody>
<tr>
<td> url</td>
<td><a href="https://developers.tw" target="_blank" rel="noopener">https://developers.tw</a></td>
</tr>
<tr>
<td>database</td>
<td> 選擇 redis</td>
</tr>
<tr>
<td>redis password</td>
<td> 在<code>資料庫安裝 (Redis)</code> 章節中，<code>requirepass</code> 的設定值</td>
</tr>
</tbody>
</table>
<p><code>url</code> 需要根據實際的域名做修改，上面範例是 #<a href="http://Developers.TW" target="_blank" rel="noopener">Developers.TW</a> 的域名。</p>
<h3 id="讓-NodeBB-隨系統自動啟動">讓 NodeBB 隨系統自動啟動</h3>
<p>使用文字編輯器新增 / 修改檔案 <code>/etc/systemd/system/nodebb.service</code>，內容為：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=NodeBB</span><br><span class="line">Documentation=https://docs.nodebb.org</span><br><span class="line">After=system.slice multi-user.target redis.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">User=nodebb</span><br><span class="line"></span><br><span class="line">StandardOutput=syslog</span><br><span class="line">StandardError=syslog</span><br><span class="line">SyslogIdentifier=nodebb</span><br><span class="line"></span><br><span class="line">WorkingDirectory=/opt/nodebb</span><br><span class="line">ExecStart=/usr/bin/node loader.js</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl enable nodebb.service</span><br><span class="line">$ sudo systemctl start nodebb.service</span><br></pre></td></tr></tbody></table></figure>
<p>啟動完成後，就可以開啟瀏覽器連到 <a href="https://developers.tw/admin" target="_blank" rel="noopener">https://developers.tw/admin</a> , 登入控制台進行 NodeBB 的管理與設定。</p>
<h2 id="小結">小結</h2>
<p>經過冗長的來來回回步驟後，終於有個可以上線的部署環境。但有了基本部署環境，NodeBB 還要根據需要進行設定與客製化，這個才是重中之重。NodeBB 的設定可以參考 <a href="https://docs.nodebb.org/" target="_blank" rel="noopener">官方的文件</a>，而 NodeBB 的進階功能，不少需要額外申請雲端服務 (如 Facebook SSO) 或者安裝軟體 (如 Solr 等)，讀者可視目的來決定是否有需要。</p>

            <div class="alert info no-icon">
                有 DevOps 技術問題？歡迎到 <a href="https://developers.tw/@山姆鍋" target="_blank" rel="noopener">#呆丸開發者</a> 跟山姆鍋討論
            </div>
            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">標籤</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tag/ubuntu/" rel="tag">Ubuntu</a> <a class="tag tag--primary tag--small t-link" href="/tag/digitalocean/" rel="tag">digitalocean</a> <a class="tag tag--primary tag--small t-link" href="/tag/iframely/" rel="tag">iframely</a> <a class="tag tag--primary tag--small t-link" href="/tag/nodebb/" rel="tag">nodebb</a> <a class="tag tag--primary tag--small t-link" href="/tag/nodejs/" rel="tag">nodejs</a> <a class="tag tag--primary tag--small t-link" href="/tag/redis/" rel="tag">redis</a> <a class="tag tag--primary tag--small t-link" href="/tag/solr/" rel="tag">solr</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/03/why-sotfware-architecture-is-necessary-by-story/"
                    data-tooltip="一個故事說明軟體架構的必要性"
                    aria-label="上一篇: 一個故事說明軟體架構的必要性"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/03/morden-web-forum-nodebb/"
                    data-tooltip="社群論壇軟體 NodeBB"
                    aria-label="下一篇: 社群論壇軟體 NodeBB"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Sampot (山姆鍋). All Rights Reserved.
    </span>
    <br/>
        <a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW"><img
                alt="創用 CC 授權條款" style="border-width:0"
                src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
        除另有標示，本著作係採用<a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW">創用 CC
            姓名標示-非商業性-相同方式分享 4.0 國際 授權條款</a>授權。
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/03/why-sotfware-architecture-is-necessary-by-story/"
                    data-tooltip="一個故事說明軟體架構的必要性"
                    aria-label="上一篇: 一個故事說明軟體架構的必要性"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/03/morden-web-forum-nodebb/"
                    data-tooltip="社群論壇軟體 NodeBB"
                    aria-label="下一篇: 社群論壇軟體 NodeBB"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/images/logo.png" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Sampot (山姆鍋)</h4>
        
            <div id="about-card-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>IT 自由工作者</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                台灣/台北
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/03/set-up-mysql-master-master-replication/"
                            aria-label=": 設定 MySQL Master-Master 複製"
                        >
                            <h3 class="media-heading">設定 MySQL Master-Master 複製</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年3月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>本文簡單說明如何設定兩台 MySQL server，讓它們彼此互相備份資料 (Master-master 模式)。雖然這樣的設定通常是支援高可用性 (high availability) 平台的一部分，但本文不包含如何完成其他 HA 的工作。設定兩台 MySQL 伺服器互相備份，主要目的就是要確認資料的安全性；同時也提高可用性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/use-pacemaker-two-node-ha-cluster/"
                            aria-label=": 使用 Pacemaker 建構雙節點叢集系統"
                        >
                            <h3 class="media-heading">使用 Pacemaker 建構雙節點叢集系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月6日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>想要達到系統高可用性 (high availability) 的需求，自然免不了需要採用現成的解決方案。本文說明如何利用 Pacemaker/heartbeat 來建構一個雙節點的從其系統。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/build-cluster-filesystem-with-glusterfs-ubuntu/"
                            aria-label=": 使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統"
                        >
                            <h3 class="media-heading">使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>在網站的叢集系統中，除了資料庫需要讓各個伺服器存取外，常常也會需要讓檔案 (圖檔，CSS 等等) 可以被叢集中的伺服器存取。 傳統上，常常使用 NFS 伺服器來達到此目的，但 NFS 本身往往成為單一失敗點 (single point of failure)。 本文介紹 GlusterFS 來建構一個簡單的雙節點叢集檔案系統，具備高可用性、高擴充性等特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/scale-wordpress-with-hyperdb/"
                            aria-label=": 使用 HyperDB 加強 WordPress 網站的資料庫擴充性"
                        >
                            <h3 class="media-heading">使用 HyperDB 加強 WordPress 網站的資料庫擴充性</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於流量高的 Wordpress 網站來說，資料庫往往是第一個出現的瓶頸。針對資料庫擴充性的問題，本文介紹 HyperDB 這個解決方案。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/create-lnmp-environment-with-nginx/"
                            aria-label=": 在 Linode 上使用 Nginx 架設 LNMP 環境"
                        >
                            <h3 class="media-heading">在 Linode 上使用 Nginx 架設 LNMP 環境</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月30日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Apache HTTPd 是很好的網站伺服器，但是對於 CPU 跟記憶體的要求較高，對於架設在 VPS 上面網站來說， 需要一個更輕量級的解決方案。越來越多人選擇使用 Nginx 架設網站，主要考量便是它的快速、穩定以及輕量的特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/05/support-sending-mail-php-linux-vps-exim/"
                            aria-label=": Linux VPS PHP 網站可以發送信件"
                        >
                            <h3 class="media-heading">Linux VPS PHP 網站可以發送信件</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年5月8日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>PHP 架站軟體通常需要用到寄信功能，例如：通知站長有新的迴響需要審核。使用虛擬主機來架站的讀者一定會納悶：<br>
不管是 WordPress，Drupal 或者其他 PHP<br>
架站軟體不是都不用另外設定就可以寄信？為什麼需要特地提到這件事情。<br>
話說山姆鍋的主機採用的是 Linode VPS，很多事情都需要自己來，唉！<br>
如果您的網站主機跟山姆鍋一樣是 VPS 或者專屬伺服器，那這篇文章也許對您有幫助。<br>
由於不是要做為公司的郵件伺服器，山姆鍋希望除了讓 PHP 架站軟體送信外，不再作其它用途。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/04/start-up/"
                            aria-label=": 影化身科技有限公司成立"
                        >
                            <h3 class="media-heading">影化身科技有限公司成立</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>2013 年 4 月 24 日，影化身科技有限公司登記成立，致力於提供雲端服務平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/shi-yong-octopresszuo-wei-bo-ke-ping-tai/"
                            aria-label=": 使用 Octopress 作為部落格平台"
                        >
                            <h3 class="media-heading">使用 Octopress 作為部落格平台</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>由於沒有需要太多動態功能，所以，嘗試使用靜態部落格平台 Octopress 來寫文章。「艾米部落」<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> 一路從 Joomla, Drupal, WordPress 到現在的 Octopress，也算是換了不少平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/use-static-site-generator-for-company-site/"
                            aria-label=": 使用靜態網頁產生器來管理公司網站"
                        >
                            <h3 class="media-heading">使用靜態網頁產生器來管理公司網站</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於不需要動態功能的網站而言，使用像是 Drupal、WordPress 之類的架站軟體，感覺有點大材小用。對於可以接受不使用「所見即所得」編輯器的人，靜態網站產生器應該是個可以接受的方案。 雖說是靜態網站，缺少很多功能，但像是公司或者行銷網站往往也不需要這些。況且， 靜態網站有諸多動態網站所沒有的功能，如：</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/exchange-name-card-with-eavatar-me/"
                            aria-label=": 如何利用「我．影化身」服務交換名片"
                        >
                            <h3 class="media-heading">如何利用「我．影化身」服務交換名片</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月29日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>今天從 MR JAMIE 上讀到一篇文章：「從今天開始，請 email 你的名片給我吧！」這讓我想到，與其使用 Email，使用「我．影化身」來代替，不是也很適當？</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 128 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-597bjprixrfzrennpanwcwfnulsqaw08wvkzphw7gk8dqunvgzd9nn3nvsu9.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://samkuo.me/post/2020/03/install-nodebb-digitalocean-production/';
              
            this.page.identifier = 'post/2020/03/install-nodebb-digitalocean-production/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'sampotkuo';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
      var algoliaClient = algoliasearch('OIWK4CBFS4', 'f676051199368fe5f161c9012b7edaf6');
      var algoliaIndex = algoliaClient.initIndex('MyBlogIndex');
    </script>


    </body>
</html>
