
<!DOCTYPE html>
<html lang="zh-tw">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="我是山姆鍋">
    <title>我的 K8S DevOps 實驗環境 - 基礎篇 - 我是山姆鍋</title>
    <meta name="author" content="Sampot (山姆鍋)">
    
    
        <link rel="icon" href="https://samkuo.me/images/favicon.png">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","/contact","/sitemap"],"image":"logo.png"},"articleBody":"雖然 Minikube、K3D 或者 Docker for Desktop 都提供 Kubernetes 測試環境可以方便開發雲原生應用軟體。但從運維角度來說，這些工具並不適合用來測試與驗證需要多節點的方案，例如：高可用的 etcd；K8S 的儲存方案如 OpenEBS, ROOK 等需要額外的儲存媒體 (e.g. 硬碟) 來實現；又或者有在主機系統額外安裝套件的需求。本文山姆鍋利用 Vagrant 跟 VirtualBox 虛擬技術作為快速拆建的實驗環境。\n\n本文所使用的原始碼可以在 GitHub 上取得。\n設計目標\n此實驗環境主要是針對想深入了解 K8S 如何部署與維護的運維人員，設定如下目標：\n\n近似生產環境：此實驗環境要盡可能與實際的生產環境組態相近。\n支援分散式架構：多節點叢集方便模擬節點故障與新增以驗證系統的可用性、擴展性以及可靠性。\n模擬雲端託管：提供負載均衡器 (load balancer) 以及持久卷 (persistent volumes) 等資源的動態建立。\n\n實作考量\n如同其他技術專案一樣，在規劃這個實驗環境時也需要面臨不同方案的取捨，以下針對幾個重要的技術選型說明背後的理由。\n虛擬技術\n山姆鍋希望這個環境設定可以跨平台 (Windows、OS X 以及 Linux)。在實際決定選用 Vagrant + VirtualBox 之前，山姆鍋評估過使用 Multipass 作為輕量的替代方案，但由於 Multipass 缺少下列特性而打消主意：\n\n支援固定的 IP 位址：無法預先知道環境中節點的 IP 位址大大增加組態設定的複雜度。\n附加額外的硬碟：由於這個環境主要是針對運維需求，也會用來實驗 K8S 不同的儲存方案，尤其是 OpenEBS 以及 ROOK。雖然某些情況下可以使用 loop device 使用檔案來模擬硬碟，但這會增加設定的複雜度也跟實際部署作法不同。\n\n另外也評估過使用 Vagrant + Libvirt (KVM) 這個方案，但對於沒有原生 Linux 環境的使用者就需要使用支援 Nested virtualization 的虛擬機方案，例如：VMWare fusion/workstation。隨著 VirtualBox 支援 Nested virtualization 的普及，之後也許會改成 Vagrant + Libvirt (KVM) 方案。\nK8S 發行版本\n由於此實驗環境一般情況下是在技術人員的工作機上執行，原本也考量使用 K3S 這個輕量化的發行版本來減少記憶體等系統資源的使用量。但稍微深入思考，會發現使用 K3S 會有下列的問題：\n\nK3S 不是 Kubernetes 雲端部署環境的主流\n K3S 與託管的 K8S 雲端服務架構上元件有明顯差異。\n\n由於前述理由選用 kubeadm 工具來部署跟多數雲端託管服務更相近的 K8S 叢集。\n組態管理工具\n安裝設定方面，在使用 BASH 腳本或者 Ansible playbooks 兩者之間猶疑不定。由於已經確定選擇透過 kubeadm 來部署 K8S 叢集，使用 BASH 腳本的複雜度還在可以控制的範圍，但山姆鍋的 BASH 腳本的功力普通，如果看到憋腳的用法還請多擔待！\n系統需求\n山姆鍋是在自己的 MacBook Pro (i7, 16GB RAM) 上測試整個實驗環境，最低的系統需求也跟環境節點數量以及設定有關。不過，還是建議工作機至少具備下列要求：\n\n\n\n項目\n數值\n\n\n\n\n RAM\n12GB+\n\n\nCPU\n2GHz+, 4+ cores\n\n\n 硬碟空間\n 60GB+\n\n\n\n在工作機上要預先安裝好 Vagrant 以及 VirtualBox，相關的安裝步驟可以參考 「Vagrant+VirtualBox 跨平台虛擬環境」這篇文章。\n叢集架構\n此實驗環境預設是由一個控制節點 (也就是 master node) 以及三個工作節點 (worker node) 組成。叢集底層的作業系統選擇 Ubuntu，除了是因為山姆鍋比較熟悉的系統外，在雲端託管的 K8S 服務中也是移植性 (portability) 較高的選項。\n下圖是此實驗環境的架構示意圖：\n\n控制節點 (Master nodes)\n雖然控制節點的高可用測試也很重要，但相對於其他元件的測試頻率低很多，加上此環境主要用來作為平台元件的部署測試用途，所以預設只使用一個控制節點。這裏所謂的「平台元件」泛指為了支援應用元件而部署的服務套件，例如為了監控用途的 Prometheus, 為了日誌需要的 ELK 推疊等等。跟雲端託管環境類似，此實驗環境預設不允許將元件部署在控制節點。\n此實驗環境可以支援最多三個控制節點，主機名稱 (hostname) 分別為: spkmaster-1, spkmaster-2 以及 spkmaster-3。其中，spkmaster-1 負責整個叢集的初始化工作。\n\n提醒：三個節點才能允許其中一個控制節點故障。即使是有兩個控制節點存在，只要其中一個故障，叢集的控制平面依然是不可用的。\n\n控制平面端點 (Control Plane Endpoint)\n叢集中的控制節點組成一個控制平面，控制平面端點提供固定位址作為其它節點或者命令行工具 (e.g. kubectl) 存取入口。此實驗環境中，控制平面端點是由 HAProxy + Keepalived 來負責實現，即使只有單一的控制節點也是如此。有了統一的控制平面端點，控制節點可以平順地從 1 個節點擴展到 3 個。\n工作節點 (Worker nodes)\n不少平台元件的高可用是基於 Quorum 機制來避免 split-brain 問題，而為了維持 Quorum, 元件至少要有 3 個副本 (replica)。基於這個需要，此實驗環境選擇啟動 3 個工作節點以更完整模擬實際部署設定。為了支援 OpenEBS 這類透過 iSCSI 協定提供區塊裝置 (block device) 的儲存方案，工作節點也預先安裝好了 open-iscsi 系統套件。每個工作節點額外有一個硬碟 (/dev/sdb) 但並沒有自動附掛 (mount)，此硬碟就是為了可以測試 OpenEBS 這類的存儲方案。\n此實驗環境最多可以支援九個工作節點，名稱分別為：spkworker-1 到 spkworker-9。\n\n之所以會有節點數量限制，是因為節點域名解析是透過 /etc/hosts 查詢，相關名稱與 IP 在建立環境時便固定了。\n\n服務負載均衡器 (Service Loadbalancers)\n在雲端託管的 K8S 環境中，雲端供應商會提供服務負載均衡器的支援。透過這樣的支援，運維人員可以透過宣告的方式建立型態 (type) 為 LoadBalancer 的服務資源 (service resource)，雲端供應商會根據此資源物件自動建立與銷毀對應的網路負載均衡器的實例。在此實驗環境，服務負載均衡器是藉由 MetalLB 實現。\n開始動手\n\n底下的指令，山姆鍋都只在 MacBook Pro 上測試過。另外，有些指令需要您根據自己的系統修改。\n\n首先從 GitHub 上，複製 (clone) 本文相關的程式：\n1git clone https://github.com/sampot/spk-cluster-lab.git\n底下都假設工作目錄位於 spk-cluster-lab 中。\n此實驗環境利用一個 .env 檔案來提供環境組態，使用下列指令複製範例檔：\n1cp .env.example .env\n透過 .env 檔案裡的變數可以調整控制節點、工作節點的數量，CPU 跟記憶體大小等等。\n跟其它 Vagrant 的環境相同，可以透過指令來對環境進行操作。下面指令可以自動建置並設定好實驗環境 (第一次需要下載跟安裝，會耗費一些時間)：\n1vagrant up\n使用虛擬機的好處是可以使用快照 (snapshot) 來儲存與回復當前狀態。環境剛部署好時，可以使用下列指令建立一個快照:\n1vagrant snapshot save baseline\n其中，baseline 是快照名稱，您可以自己決定。\n實驗測試完後，要讓環境回到已知的快照，可以使用下列指令:\n1vagrant snapshot restore baseline\n其它 Vagrant 虛擬機管理操作，請自行參考 Vagrant 文件。\n為了避免依賴工作機的設置，程式碼儲存庫中的腳本大多假設是從第一個控制節點 (master node) 內操作，該節點同時安裝常用的工具如 kubectl, helm 等。可以透過下列指令登入第一個控制節點：\n1vagrant ssh spkmaster-1\n下圖是登入 spkmaster-1 後，執行 kubectl get nodes 的畫面：\n\n從工作機操作\n雖然可以從虛擬機內進行大部分操作，但如果需要使用工作機現有的工具來操作叢集，可以按照下列步驟進行。\n設定 /etc/hosts 檔案 (Windows 系統則是 c:\\Windows\\System32\\Drivers\\etc\\hosts)，增加：\n1172.42.42.10  spkcluster spkcluster.lab.local\n‘172.42.42.10’ 是個虛擬 IP 位址作為 K8S 控制平面的端點位址，當前綁定的控制節點如果故障，此 IP 會自動轉移到另一個控制節點 (如果有設定高可用的話)。\n設定 KUBECONFIG 環境變數，讓 KUBECONFIG 指到 spk-cluster-lab 目錄中的 .kube/config 檔案。在 Linux 或者 OS X 可以下列指令設定：\n1export KUBECONFIG=$(PWD)/.kube/config\n一旦設定完成則可以使用工作機上的 kubectl 來進行操作。\n小結\n此文描述的是此實驗環境的基本設定，除了高可用 K8S 叢集，GitHub 上的腳本已經可以支援服務負載均衡以及動態持久卷 (dynamic persistent volumes) 的支持。即使功能看起來完整，但山姆鍋是不建議將這樣的設置複製為生產環境的。\n參考資料\n\nk8s_ubuntu\nBootstraping clusters with kubeadm\nHow to build a full kubernetes cluster in your home lab using an automated, easy and fancy way!\n\n","dateCreated":"2020-05-30T19:58:09+08:00","dateModified":"2020-05-31T09:53:33+08:00","datePublished":"2020-05-30T19:58:09+08:00","description":"雖然 Minikube、K3D 或者 Docker for Desktop 都提供 Kubernetes 測試環境可以方便開發雲原生應用軟體。但從運維角度來說，這些工具並不適合用來測試與驗證需要多節點的方案，例如：高可用的 etcd；K8S 的儲存方案如 OpenEBS, ROOK 等需要額外的儲存媒體 (e.g. 硬碟) 來實現；又或者有在主機系統額外安裝套件的需求。本文山姆鍋利用 Vagrant 跟 VirtualBox 虛擬技術作為快速拆建的實驗環境。","headline":"我的 K8S DevOps 實驗環境 - 基礎篇","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"},"publisher":{"@type":"Organization","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","/contact","/sitemap"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/","keywords":"Kubernetes, DevOps, SPK Cluster, Vagrant, VirtualBox, HAProxy, Keepalived"}</script>
    <meta name="description" content="雖然 Minikube、K3D 或者 Docker for Desktop 都提供 Kubernetes 測試環境可以方便開發雲原生應用軟體。但從運維角度來說，這些工具並不適合用來測試與驗證需要多節點的方案，例如：高可用的 etcd；K8S 的儲存方案如 OpenEBS, ROOK 等需要額外的儲存媒體 (e.g. 硬碟) 來實現；又或者有在主機系統額外安裝套件的需求。本文山姆鍋利用 Vagran">
<meta property="og:type" content="blog">
<meta property="og:title" content="我的 K8S DevOps 實驗環境 - 基礎篇">
<meta property="og:url" content="https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/">
<meta property="og:site_name" content="我是山姆鍋">
<meta property="og:description" content="雖然 Minikube、K3D 或者 Docker for Desktop 都提供 Kubernetes 測試環境可以方便開發雲原生應用軟體。但從運維角度來說，這些工具並不適合用來測試與驗證需要多節點的方案，例如：高可用的 etcd；K8S 的儲存方案如 OpenEBS, ROOK 等需要額外的儲存媒體 (e.g. 硬碟) 來實現；又或者有在主機系統額外安裝套件的需求。本文山姆鍋利用 Vagran">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/environment.drawio.svg">
<meta property="og:image" content="https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/kubectl-get-nodes.png">
<meta property="article:published_time" content="2020-05-30T11:58:09.840Z">
<meta property="article:modified_time" content="2020-05-31T01:53:33.284Z">
<meta property="article:author" content="Sampot (山姆鍋)">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="SPK Cluster">
<meta property="article:tag" content="Vagrant">
<meta property="article:tag" content="VirtualBox">
<meta property="article:tag" content="HAProxy">
<meta property="article:tag" content="Keepalived">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/environment.drawio.svg">
<meta name="twitter:creator" content="@sampotkuo">
<meta property="fb:app_id" content="1538037013031361">
    
    
        
    
    <meta property="og:image" content="https://samkuo.me/images/featured_image.jpg"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-lfspghztdttlloh4nly9hmp3cqmehlzaagf5ften7wo63faxiltzljjm4fb0.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41152700-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-41152700-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="fb-root"></div>
        <script async defer crossorigin="anonymous"
            src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=1538037013031361&autoLogAppEvents=1"></script>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
        <img class="header-avatar-picture" src="/images/logo32.png" alt="作者的圖片" />
            我是山姆鍋
        </a>
    </div>
    
        
            <a
                class="header-right-icon open-algolia-search"
                href="#search"
                aria-label="打開鏈接: /#search"
            >
        
        
            <i class="fa fa-search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/images/logo.png" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Sampot (山姆鍋)</h4>
                
                    <h5 class="sidebar-profile-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/sampot"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/contact"
                            
                            rel="noopener"
                            title="聯絡"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">聯絡</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/sitemap"
                            
                            rel="noopener"
                            title="網站導覽"
                        >
                        <i class="sidebar-button-icon fa fa-sitemap" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">網站導覽</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://feedly.com/i/subscription/feed/https://samkuo.me/atom.xml"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            我的 K8S DevOps 實驗環境 - 基礎篇
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-05-30T19:58:09+08:00">
	
		    5月 30, 2020
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <div class="alert info no-icon">
                我是山姆鍋 <div class="fb-like" data-href="https://www.facebook.com/sampotkuo" data-width="" data-layout="standard" data-action="like" data-size="large" data-share="false"></div>
            </div>

            <p>雖然 Minikube、K3D 或者 Docker for Desktop 都提供 Kubernetes 測試環境可以方便開發雲原生應用軟體。但從運維角度來說，這些工具並不適合用來測試與驗證需要多節點的方案，例如：高可用的 etcd；K8S 的儲存方案如 <a href="https://openebs.io/" target="_blank" rel="noopener">OpenEBS</a>, <a href="https://rook.io/" target="_blank" rel="noopener">ROOK</a> 等需要額外的儲存媒體 (e.g. 硬碟) 來實現；又或者有在主機系統額外安裝套件的需求。本文山姆鍋利用 Vagrant 跟 VirtualBox 虛擬技術作為快速拆建的實驗環境。</p>
<a id="more"></a>
<p>本文所使用的原始碼可以在 <a href="https://github.com/sampot/spk-cluster-lab" target="_blank" rel="noopener">GitHub</a> 上取得。</p>
<h2 id="設計目標">設計目標</h2>
<p>此實驗環境主要是針對想深入了解 K8S 如何部署與維護的運維人員，設定如下目標：</p>
<ol>
<li>近似生產環境：此實驗環境要盡可能與實際的生產環境組態相近。</li>
<li>支援分散式架構：多節點叢集方便模擬節點故障與新增以驗證系統的可用性、擴展性以及可靠性。</li>
<li>模擬雲端託管：提供負載均衡器 (load balancer) 以及持久卷 (persistent volumes) 等資源的動態建立。</li>
</ol>
<h2 id="實作考量">實作考量</h2>
<p>如同其他技術專案一樣，在規劃這個實驗環境時也需要面臨不同方案的取捨，以下針對幾個重要的技術選型說明背後的理由。</p>
<h3 id="虛擬技術">虛擬技術</h3>
<p>山姆鍋希望這個環境設定可以跨平台 (Windows、OS X 以及 Linux)。在實際決定選用 Vagrant + VirtualBox 之前，山姆鍋評估過使用 Multipass 作為輕量的替代方案，但由於 Multipass 缺少下列特性而打消主意：</p>
<ul>
<li>支援固定的 IP 位址：無法預先知道環境中節點的 IP 位址大大增加組態設定的複雜度。</li>
<li>附加額外的硬碟：由於這個環境主要是針對運維需求，也會用來實驗 K8S 不同的儲存方案，尤其是 OpenEBS 以及 ROOK。雖然某些情況下可以使用 loop device 使用檔案來模擬硬碟，但這會增加設定的複雜度也跟實際部署作法不同。</li>
</ul>
<p>另外也評估過使用 Vagrant + Libvirt (KVM) 這個方案，但對於沒有原生 Linux 環境的使用者就需要使用支援 Nested virtualization 的虛擬機方案，例如：VMWare fusion/workstation。隨著 VirtualBox 支援 Nested virtualization 的普及，之後也許會改成 Vagrant + Libvirt (KVM) 方案。</p>
<h3 id="K8S-發行版本">K8S 發行版本</h3>
<p>由於此實驗環境一般情況下是在技術人員的工作機上執行，原本也考量使用 K3S 這個輕量化的發行版本來減少記憶體等系統資源的使用量。但稍微深入思考，會發現使用 K3S 會有下列的問題：</p>
<ol>
<li>K3S 不是 Kubernetes 雲端部署環境的主流</li>
<li> K3S 與託管的 K8S 雲端服務架構上元件有明顯差異。</li>
</ol>
<p>由於前述理由選用 kubeadm 工具來部署跟多數雲端託管服務更相近的 K8S 叢集。</p>
<h3 id="組態管理工具">組態管理工具</h3>
<p>安裝設定方面，在使用 BASH 腳本或者 Ansible playbooks 兩者之間猶疑不定。由於已經確定選擇透過 kubeadm 來部署 K8S 叢集，使用 BASH 腳本的複雜度還在可以控制的範圍，但山姆鍋的 BASH 腳本的功力普通，如果看到憋腳的用法還請多擔待！</p>
<h2 id="系統需求">系統需求</h2>
<p>山姆鍋是在自己的 MacBook Pro (i7, 16GB RAM) 上測試整個實驗環境，最低的系統需求也跟環境節點數量以及設定有關。不過，還是建議工作機至少具備下列要求：</p>
<table>
<thead>
<tr>
<th>項目</th>
<th>數值</th>
</tr>
</thead>
<tbody>
<tr>
<td> RAM</td>
<td>12GB+</td>
</tr>
<tr>
<td>CPU</td>
<td>2GHz+, 4+ cores</td>
</tr>
<tr>
<td> 硬碟空間</td>
<td> 60GB+</td>
</tr>
</tbody>
</table>
<p>在工作機上要預先安裝好 Vagrant 以及 VirtualBox，相關的安裝步驟可以參考 「<a href="/post/2020/05/vagrant-virtualbox-devops-tool/" title="Vagrant+VirtualBox 跨平台虛擬環境">Vagrant+VirtualBox 跨平台虛擬環境</a>」這篇文章。</p>
<h2 id="叢集架構">叢集架構</h2>
<p>此實驗環境預設是由一個控制節點 (也就是 master node) 以及三個工作節點 (worker node) 組成。叢集底層的作業系統選擇 Ubuntu，除了是因為山姆鍋比較熟悉的系統外，在雲端託管的 K8S 服務中也是移植性 (portability) 較高的選項。</p>
<p>下圖是此實驗環境的架構示意圖：</p>
<div class="figure " style="width:;"><a class="fancybox" href="environment.drawio.svg" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="environment.drawio.svg" alt=""></a></div>
<h3 id="控制節點-Master-nodes">控制節點 (Master nodes)</h3>
<p>雖然控制節點的高可用測試也很重要，但相對於其他元件的測試頻率低很多，加上此環境主要用來作為平台元件的部署測試用途，所以預設只使用一個控制節點。這裏所謂的「平台元件」泛指為了支援應用元件而部署的服務套件，例如為了監控用途的 Prometheus, 為了日誌需要的 ELK 推疊等等。跟雲端託管環境類似，此實驗環境預設不允許將元件部署在控制節點。</p>
<p>此實驗環境可以支援最多三個控制節點，主機名稱 (hostname) 分別為: spkmaster-1, spkmaster-2 以及 spkmaster-3。其中，spkmaster-1 負責整個叢集的初始化工作。</p>
<blockquote>
<p>提醒：三個節點才能允許其中一個控制節點故障。即使是有兩個控制節點存在，只要其中一個故障，叢集的控制平面依然是不可用的。</p>
</blockquote>
<h3 id="控制平面端點-Control-Plane-Endpoint">控制平面端點 (Control Plane Endpoint)</h3>
<p>叢集中的控制節點組成一個控制平面，控制平面端點提供固定位址作為其它節點或者命令行工具 (e.g. kubectl) 存取入口。此實驗環境中，控制平面端點是由 HAProxy + Keepalived 來負責實現，即使只有單一的控制節點也是如此。有了統一的控制平面端點，控制節點可以平順地從 1 個節點擴展到 3 個。</p>
<h3 id="工作節點-Worker-nodes">工作節點 (Worker nodes)</h3>
<p>不少平台元件的高可用是基於 <a href="https://en.wikipedia.org/wiki/Quorum" target="_blank" rel="noopener">Quorum</a> 機制來避免 split-brain 問題，而為了維持 Quorum, 元件至少要有 3 個副本 (replica)。基於這個需要，此實驗環境選擇啟動 3 個工作節點以更完整模擬實際部署設定。為了支援 OpenEBS 這類透過 iSCSI 協定提供區塊裝置 (block device) 的儲存方案，工作節點也預先安裝好了 <code>open-iscsi</code> 系統套件。每個工作節點額外有一個硬碟 (/dev/sdb) 但並沒有自動附掛 (mount)，此硬碟就是為了可以測試 OpenEBS 這類的存儲方案。</p>
<p>此實驗環境最多可以支援九個工作節點，名稱分別為：spkworker-1 到 spkworker-9。</p>
<blockquote>
<p>之所以會有節點數量限制，是因為節點域名解析是透過 /etc/hosts 查詢，相關名稱與 IP 在建立環境時便固定了。</p>
</blockquote>
<h3 id="服務負載均衡器-Service-Loadbalancers">服務負載均衡器 (Service Loadbalancers)</h3>
<p>在雲端託管的 K8S 環境中，雲端供應商會提供服務負載均衡器的支援。透過這樣的支援，運維人員可以透過宣告的方式建立型態 (type) 為 LoadBalancer 的服務資源 (service resource)，雲端供應商會根據此資源物件自動建立與銷毀對應的網路負載均衡器的實例。在此實驗環境，服務負載均衡器是藉由 <a href="https://metallb.universe.tf/" target="_blank" rel="noopener">MetalLB</a> 實現。</p>
<h2 id="開始動手">開始動手</h2>
<blockquote>
<p>底下的指令，山姆鍋都只在 MacBook Pro 上測試過。另外，有些指令需要您根據自己的系統修改。</p>
</blockquote>
<p>首先從 GitHub 上，複製 (clone) 本文相關的程式：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/sampot/spk-cluster-lab.git</span><br></pre></td></tr></tbody></table></figure>
<p>底下都假設工作目錄位於 <code>spk-cluster-lab</code> 中。</p>
<p>此實驗環境利用一個 <code>.env</code> 檔案來提供環境組態，使用下列指令複製範例檔：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp .env.example .env</span><br></pre></td></tr></tbody></table></figure>
<p>透過 <code>.env</code> 檔案裡的變數可以調整控制節點、工作節點的數量，CPU 跟記憶體大小等等。</p>
<p>跟其它 Vagrant 的環境相同，可以透過指令來對環境進行操作。下面指令可以自動建置並設定好實驗環境 (第一次需要下載跟安裝，會耗費一些時間)：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></tbody></table></figure>
<p>使用虛擬機的好處是可以使用快照 (snapshot) 來儲存與回復當前狀態。環境剛部署好時，可以使用下列指令建立一個快照:</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant snapshot save baseline</span><br></pre></td></tr></tbody></table></figure>
<p>其中，<code>baseline</code> 是快照名稱，您可以自己決定。</p>
<p>實驗測試完後，要讓環境回到已知的快照，可以使用下列指令:</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant snapshot restore baseline</span><br></pre></td></tr></tbody></table></figure>
<p>其它 Vagrant 虛擬機管理操作，請自行參考 <a href="https://www.vagrantup.com/docs/" target="_blank" rel="noopener">Vagrant 文件</a>。</p>
<p>為了避免依賴工作機的設置，程式碼儲存庫中的腳本大多假設是從第一個控制節點 (master node) 內操作，該節點同時安裝常用的工具如 kubectl, helm 等。可以透過下列指令登入第一個控制節點：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh spkmaster-1</span><br></pre></td></tr></tbody></table></figure>
<p>下圖是登入 spkmaster-1 後，執行 <code>kubectl get nodes</code> 的畫面：</p>
<div class="figure " style="width:;"><a class="fancybox" href="kubectl-get-nodes.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="kubectl-get-nodes.png" alt=""></a></div>
<h2 id="從工作機操作">從工作機操作</h2>
<p>雖然可以從虛擬機內進行大部分操作，但如果需要使用工作機現有的工具來操作叢集，可以按照下列步驟進行。</p>
<p>設定 /etc/hosts 檔案 (Windows 系統則是 c:\Windows\System32\Drivers\etc\hosts)，增加：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.42.42.10  spkcluster spkcluster.lab.local</span><br></pre></td></tr></tbody></table></figure>
<p>‘172.42.42.10’ 是個虛擬 IP 位址作為 K8S 控制平面的端點位址，當前綁定的控制節點如果故障，此 IP 會自動轉移到另一個控制節點 (如果有設定高可用的話)。</p>
<p>設定 <code>KUBECONFIG</code> 環境變數，讓 <code>KUBECONFIG</code> 指到 <code>spk-cluster-lab</code> 目錄中的 <code>.kube/config</code> 檔案。在 Linux 或者 OS X 可以下列指令設定：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KUBECONFIG=$(PWD)/.kube/config</span><br></pre></td></tr></tbody></table></figure>
<p>一旦設定完成則可以使用工作機上的 <code>kubectl</code> 來進行操作。</p>
<h2 id="小結">小結</h2>
<p>此文描述的是此實驗環境的基本設定，除了高可用 K8S 叢集，GitHub 上的腳本已經可以支援服務負載均衡以及動態持久卷 (dynamic persistent volumes) 的支持。即使功能看起來完整，但山姆鍋是不建議將這樣的設置複製為生產環境的。</p>
<h2 id="參考資料">參考資料</h2>
<ul>
<li><a href="https://bitbucket.org/exxsyseng/k8s_ubuntu/src/master/" target="_blank" rel="noopener">k8s_ubuntu</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noopener">Bootstraping clusters with kubeadm</a></li>
<li><a href="https://medium.com/kuberverse/how-to-build-a-full-kubernetes-cluster-in-your-home-lab-using-an-automated-easy-and-fancy-way-e5853ae4e08" target="_blank" rel="noopener">How to build a full kubernetes cluster in your home lab using an automated, easy and fancy way!</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">標籤</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tag/devops/" rel="tag">DevOps</a> <a class="tag tag--primary tag--small t-link" href="/tag/haproxy/" rel="tag">HAProxy</a> <a class="tag tag--primary tag--small t-link" href="/tag/keepalived/" rel="tag">Keepalived</a> <a class="tag tag--primary tag--small t-link" href="/tag/kubernetes/" rel="tag">Kubernetes</a> <a class="tag tag--primary tag--small t-link" href="/tag/spk-cluster/" rel="tag">SPK Cluster</a> <a class="tag tag--primary tag--small t-link" href="/tag/vagrant/" rel="tag">Vagrant</a> <a class="tag tag--primary tag--small t-link" href="/tag/virtualbox/" rel="tag">VirtualBox</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/06/my-k8s-devops-lab-control-plane-endpoint/"
                    data-tooltip="我的 K8S DevOps 實驗環境 - 控制平面端點"
                    aria-label="上一篇: 我的 K8S DevOps 實驗環境 - 控制平面端點"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/05/vagrant-virtualbox-devops-tool/"
                    data-tooltip="Vagrant+VirtualBox 跨平台虛擬環境"
                    aria-label="下一篇: Vagrant+VirtualBox 跨平台虛擬環境"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Sampot (山姆鍋). All Rights Reserved.
    </span>
    <br/>
        <a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW"><img
                alt="創用 CC 授權條款" style="border-width:0"
                src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
        除另有標示，本著作係採用<a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW">創用 CC
            姓名標示-非商業性-相同方式分享 4.0 國際 授權條款</a>授權。
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/06/my-k8s-devops-lab-control-plane-endpoint/"
                    data-tooltip="我的 K8S DevOps 實驗環境 - 控制平面端點"
                    aria-label="上一篇: 我的 K8S DevOps 實驗環境 - 控制平面端點"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2020/05/vagrant-virtualbox-devops-tool/"
                    data-tooltip="Vagrant+VirtualBox 跨平台虛擬環境"
                    aria-label="下一篇: Vagrant+VirtualBox 跨平台虛擬環境"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/images/logo.png" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Sampot (山姆鍋)</h4>
        
            <div id="about-card-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>IT 自由工作者</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                台灣/台北
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/03/set-up-mysql-master-master-replication/"
                            aria-label=": 設定 MySQL Master-Master 複製"
                        >
                            <h3 class="media-heading">設定 MySQL Master-Master 複製</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年3月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>本文簡單說明如何設定兩台 MySQL server，讓它們彼此互相備份資料 (Master-master 模式)。雖然這樣的設定通常是支援高可用性 (high availability) 平台的一部分，但本文不包含如何完成其他 HA 的工作。設定兩台 MySQL 伺服器互相備份，主要目的就是要確認資料的安全性；同時也提高可用性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/use-pacemaker-two-node-ha-cluster/"
                            aria-label=": 使用 Pacemaker 建構雙節點叢集系統"
                        >
                            <h3 class="media-heading">使用 Pacemaker 建構雙節點叢集系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月6日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>想要達到系統高可用性 (high availability) 的需求，自然免不了需要採用現成的解決方案。本文說明如何利用 Pacemaker/heartbeat 來建構一個雙節點的從其系統。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/build-cluster-filesystem-with-glusterfs-ubuntu/"
                            aria-label=": 使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統"
                        >
                            <h3 class="media-heading">使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>在網站的叢集系統中，除了資料庫需要讓各個伺服器存取外，常常也會需要讓檔案 (圖檔，CSS 等等) 可以被叢集中的伺服器存取。 傳統上，常常使用 NFS 伺服器來達到此目的，但 NFS 本身往往成為單一失敗點 (single point of failure)。 本文介紹 GlusterFS 來建構一個簡單的雙節點叢集檔案系統，具備高可用性、高擴充性等特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/scale-wordpress-with-hyperdb/"
                            aria-label=": 使用 HyperDB 加強 WordPress 網站的資料庫擴充性"
                        >
                            <h3 class="media-heading">使用 HyperDB 加強 WordPress 網站的資料庫擴充性</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於流量高的 Wordpress 網站來說，資料庫往往是第一個出現的瓶頸。針對資料庫擴充性的問題，本文介紹 HyperDB 這個解決方案。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/create-lnmp-environment-with-nginx/"
                            aria-label=": 在 Linode 上使用 Nginx 架設 LNMP 環境"
                        >
                            <h3 class="media-heading">在 Linode 上使用 Nginx 架設 LNMP 環境</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月30日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Apache HTTPd 是很好的網站伺服器，但是對於 CPU 跟記憶體的要求較高，對於架設在 VPS 上面網站來說， 需要一個更輕量級的解決方案。越來越多人選擇使用 Nginx 架設網站，主要考量便是它的快速、穩定以及輕量的特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/05/support-sending-mail-php-linux-vps-exim/"
                            aria-label=": Linux VPS PHP 網站可以發送信件"
                        >
                            <h3 class="media-heading">Linux VPS PHP 網站可以發送信件</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年5月8日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>PHP 架站軟體通常需要用到寄信功能，例如：通知站長有新的迴響需要審核。使用虛擬主機來架站的讀者一定會納悶：<br>
不管是 WordPress，Drupal 或者其他 PHP<br>
架站軟體不是都不用另外設定就可以寄信？為什麼需要特地提到這件事情。<br>
話說山姆鍋的主機採用的是 Linode VPS，很多事情都需要自己來，唉！<br>
如果您的網站主機跟山姆鍋一樣是 VPS 或者專屬伺服器，那這篇文章也許對您有幫助。<br>
由於不是要做為公司的郵件伺服器，山姆鍋希望除了讓 PHP 架站軟體送信外，不再作其它用途。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/04/start-up/"
                            aria-label=": 影化身科技有限公司成立"
                        >
                            <h3 class="media-heading">影化身科技有限公司成立</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>2013 年 4 月 24 日，影化身科技有限公司登記成立，致力於提供雲端服務平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/shi-yong-octopresszuo-wei-bo-ke-ping-tai/"
                            aria-label=": 使用 Octopress 作為部落格平台"
                        >
                            <h3 class="media-heading">使用 Octopress 作為部落格平台</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>由於沒有需要太多動態功能，所以，嘗試使用靜態部落格平台 Octopress 來寫文章。「艾米部落」<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> 一路從 Joomla, Drupal, WordPress 到現在的 Octopress，也算是換了不少平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/use-static-site-generator-for-company-site/"
                            aria-label=": 使用靜態網頁產生器來管理公司網站"
                        >
                            <h3 class="media-heading">使用靜態網頁產生器來管理公司網站</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於不需要動態功能的網站而言，使用像是 Drupal、WordPress 之類的架站軟體，感覺有點大材小用。對於可以接受不使用「所見即所得」編輯器的人，靜態網站產生器應該是個可以接受的方案。 雖說是靜態網站，缺少很多功能，但像是公司或者行銷網站往往也不需要這些。況且， 靜態網站有諸多動態網站所沒有的功能，如：</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/exchange-name-card-with-eavatar-me/"
                            aria-label=": 如何利用「我．影化身」服務交換名片"
                        >
                            <h3 class="media-heading">如何利用「我．影化身」服務交換名片</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月29日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>今天從 MR JAMIE 上讀到一篇文章：「從今天開始，請 email 你的名片給我吧！」這讓我想到，與其使用 Email，使用「我．影化身」來代替，不是也很適當？</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 136 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-597bjprixrfzrennpanwcwfnulsqaw08wvkzphw7gk8dqunvgzd9nn3nvsu9.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://samkuo.me/post/2020/05/my-k8s-devops-lab-env/';
              
            this.page.identifier = 'post/2020/05/my-k8s-devops-lab-env/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'sampotkuo';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
      var algoliaClient = algoliasearch('OIWK4CBFS4', 'f676051199368fe5f161c9012b7edaf6');
      var algoliaIndex = algoliaClient.initIndex('MyBlogIndex');
    </script>


    </body>
</html>
