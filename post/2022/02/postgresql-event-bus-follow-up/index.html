
<!DOCTYPE html>
<html lang="zh-tw">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="我是山姆鍋">
    <title>PostgreSQL 事件總線實作驗證 (後續) - 我是山姆鍋</title>
    <meta name="author" content="Sampot (山姆鍋)">
    
    
        <link rel="icon" href="https://samkuo.me/images/favicon.png">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","/contact","/sitemap"],"image":"logo.png"},"articleBody":"這篇 「PostgreSQL 事件總線 (event bus) 實作驗證」文章意外地在臉書引起一些負面評價。究其原因，可能是山姆鍋對於實際使用情境跟與其搭配的產品特性說明不夠清楚所導致。雖然 “I know what I’m doing”, 但為了避免該篇文章被視為誤人子弟的負面教材，只好再來平反一下。\n\n首先，山姆鍋正在開發的軟體產品對於稽核紀錄 (auditing log) 有特別的要求，其中一個需求是使用者對資料的所有修改動作都要有對應的稽核紀錄。概念上，資料庫中資料的修改都是一種「事件 (event)」，而這樣的事件，除了產生稽核紀錄外，也有很多其它潛在用途。所以，山姆鍋選擇以非同步方式將這些事件送給其它元件來負責後續處理，其中一個便是負責產生稽核紀錄，這也是為何前篇文章中，「產生安全稽核紀錄」被列在第一項應用的原因。\n關於事件的傳遞，如果選擇在資料庫修改交易完成後，以訊息服務 (如 RabbitMQ/Kafka) 來傳遞事件，會先面臨一個不常發生但棘手的問題：資料修改了，但事件沒送出。事件沒送出，可能是臨時的網路問題或者傳送的程序異常終止，原因不一而足。為了避開這個問題，山姆鍋選擇將事件隨同資料修改在同一個交易 (transaction) 中完成，如此，確保事件的發生被正確紀錄，且這些事件也會長期存放在資料庫中 (最終太舊的資料會被清除，但不影響這裡的論述)。但接下來的問題便是：其它需要處理這些事件的元件 (也稱為事件消費者 /consumer) 要如何即時地收到這些事件通知？如何按照事件發生的時間順序，不遺漏地處理這些事件？\n從上面的描述可知，事件的資料已經存在資料庫中，且歷史事件也可能因為新的需求而被重新處理。在說明如何解決上述問題前，就需要先說明這個 Event bus 的設計所要支援的產品特性。這個軟體產品是針對中小型企業內部使用的系統，實際使用者是 IT 工程師，且由 IT 工程師自行安裝以及運維。所以，可以假設這個產品的同時在線使用人數不高，對多數客戶來說可能是個位數。雖然此軟體可以跑在 3 台來實現高可用需求，但在最精簡的配置，整個系統的所有服務要能夠跑在一台伺服器上。所以，自然會希望這個軟體需要的服務元件越少越好，但其中一定有的服務元件是 PostgreSQL (主資料庫)，跟 Redis (Cache)。\n關於通知元件有新事件發生的作法，大致有考慮以下三個方案：\n\nRedis Streams\nRabbitMQ\nKafka\n\n基於上述架構精簡化的原因，加上不能假設企業的 IT 工程師有能力維護一套 Kafka 系統，Kafka 很早就被排除在方案之外。Redis 的 AOF persistence (預設 fsync 時間為 1 秒) 以及 replication 並無法保證在 Redis carsh 時資料不會遺失。不過這點在這裡不是問題，因為實際的事件資料已經存在 PostgreSQL, 這裡 Redis/RabbitMQ 只是用來分發 / 通知新的事件。\nEvent consumer 一開始執行 (或者跟訊息服務斷線) 會先確認自己取得對應 subscription 的處理資格 (透過 distributed lock), 然後便是從 PostgreSQL 處理歷史資料，等到歷史資料處理完畢，才會接收新事件處理。所以，Redis Streams 跟 RabbitMQ 其實都是可行的方案，不過細心的讀者應該已經猜到山姆鍋選擇的作法：就是 Redis Streams。原因很簡單，因為產品裡已經有 Redis 了！\n不過，為何上篇文章提到的 Event bus 沒有用 Redis Streams 而是全部使用 PostgreSQL 提供的機制？背後的原因是為了完成上面 PostgreSQL + Redis Streams 的事件處理架構，還需要有個元件 (底下稱為 Pumper) 負責將新的事件資料轉發到 Redis Streams, 而完成 Pumper 這個元件的要求就跟上篇文章中的 Event consumer 相同，需要即時知道有新事件，事件要按照時間順序處理且不能遺漏。為了備援，可能會有多個 Pumper 實例同時在執行，但同時間只能有一個在處理事件，這個可以使用 Distributed lock 來達成。至於通知，簡單的 pubsub 機制就可以實現。\nDistributed lock 以及 Pubsub 這兩個技術要求，Redis 以及 PostgreSQL 都可以提供支援。之所以選擇使用 PostgreSQL 方案，上篇文章作為方案驗證，單純使用 PostgreSQL 實作上比較簡單，但也適用在 consumer 數量不多的情況下。所以，PostgreSQL 自始至終都是作為 Event store 的用途，Event bus 的功能確實是投機取巧 (不用白不用？)。\n下面針對臉書上的一些反饋，山姆鍋提供一下自己的看法。\n“pg 這麼用，如果只是小貓二三隻的公司內部系統當然還死不了”\n不好意思，目標客戶真的是小貓二三隻。\n“db master 只有一台，要 Scale 一定要 down time”\nMaster 資料庫是這個產品的核心元件，如果主資料庫要硬體升級或者其他原因需要停機，整個服務都會停止。這跟有沒有把 PostgreSQL 作為 MQ 或者 locking server 對於可用性的結果都一樣。\n“db 只用來存需要 long term persistance 的 data”\n前面已經說明，PostgreSQL 用來長期存放事件資料。也許有讀者會認為：這不是跟 Event sourcing 的機制很像？沒錯，只不過在這個產品，Event store/bus 並不是要支援 Event sourcing。\n“這玩法就是 outbox pattern 的誤用啊”\nTransactional outbox 老實說是第一次聽到，雖然這樣的 Pattern 在 N 年前山姆鍋就已經知道，不過有了名稱，之後跟別人說明也比較方便了 :-)。\n小結\n作為一個工程師，山姆鍋常常跟團隊分享：選擇適合的方案來解決問題，而不是找尋 (自認) 完美的作法。了解工具的特性、分析優缺點、根據實際的使用情境挑選適當可行方案才是務實的作法。所謂「適當」，也就是知道自己的取捨是什麼，記得不存在所謂放諸四海皆準的通則。最後，如果 “You know what you are doing”, 不用擔心跟別人意見相左。\n","dateCreated":"2022-02-21T21:40:24+08:00","dateModified":"2022-02-22T07:10:21+08:00","datePublished":"2022-02-21T21:40:24+08:00","description":"這篇 「PostgreSQL 事件總線 (event bus) 實作驗證」文章意外地在臉書引起一些負面評價。究其原因，可能是山姆鍋對於實際使用情境跟與其搭配的產品特性說明不夠清楚所導致。雖然 “I know what I’m doing”, 但為了避免該篇文章被視為誤人子弟的負面教材，只好再來平反一下。","headline":"PostgreSQL 事件總線實作驗證 (後續)","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"},"publisher":{"@type":"Organization","name":"Sampot (山姆鍋)","sameAs":["https://github.com/sampot","https://twitter.com/sampotkuo","https://facebook.com/sampotkuo","/contact","/sitemap"],"image":"logo.png","logo":{"@type":"ImageObject","url":"logo.png"}},"url":"https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"}</script>
    <meta name="description" content="這篇 「PostgreSQL 事件總線 (event bus) 實作驗證」文章意外地在臉書引起一些負面評價。究其原因，可能是山姆鍋對於實際使用情境跟與其搭配的產品特性說明不夠清楚所導致。雖然 “I know what I’m doing”, 但為了避免該篇文章被視為誤人子弟的負面教材，只好再來平反一下。">
<meta property="og:type" content="blog">
<meta property="og:title" content="PostgreSQL 事件總線實作驗證 (後續)">
<meta property="og:url" content="https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/">
<meta property="og:site_name" content="我是山姆鍋">
<meta property="og:description" content="這篇 「PostgreSQL 事件總線 (event bus) 實作驗證」文章意外地在臉書引起一些負面評價。究其原因，可能是山姆鍋對於實際使用情境跟與其搭配的產品特性說明不夠清楚所導致。雖然 “I know what I’m doing”, 但為了避免該篇文章被視為誤人子弟的負面教材，只好再來平反一下。">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2022-02-21T13:40:24.000Z">
<meta property="article:modified_time" content="2022-02-21T23:10:21.629Z">
<meta property="article:author" content="Sampot (山姆鍋)">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@sampotkuo">
<meta property="fb:app_id" content="1538037013031361">
    
    
        
    
    <meta property="og:image" content="https://samkuo.me/images/featured_image.jpg"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-lfspghztdttlloh4nly9hmp3cqmehlzaagf5ften7wo63faxiltzljjm4fb0.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41152700-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-41152700-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="fb-root"></div>
        <script async defer crossorigin="anonymous"
            src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=1538037013031361&autoLogAppEvents=1"></script>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
        <img class="header-avatar-picture" src="/images/logo32.png" alt="作者的圖片" />
            我是山姆鍋
        </a>
    </div>
    
        
            <a
                class="header-right-icon open-algolia-search"
                href="#search"
                aria-label="打開鏈接: /#search"
            >
        
        
            <i class="fa fa-search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/images/logo.png" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Sampot (山姆鍋)</h4>
                
                    <h5 class="sidebar-profile-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/sampot"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/sampotkuo"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/contact"
                            
                            rel="noopener"
                            title="聯絡"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">聯絡</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/sitemap"
                            
                            rel="noopener"
                            title="網站導覽"
                        >
                        <i class="sidebar-button-icon fa fa-sitemap" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">網站導覽</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://feedly.com/i/subscription/feed/https://samkuo.me/atom.xml"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            PostgreSQL 事件總線實作驗證 (後續)
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-02-21T21:40:24+08:00">
	
		    2月 21, 2022
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <div class="alert info no-icon">
                我是山姆鍋 <div class="fb-like" data-href="https://www.facebook.com/sampotkuo" data-width="" data-layout="standard" data-action="like" data-size="large" data-share="false"></div>
            </div>

            <p>這篇 <a href="/post/2022/02/postgresql-event-bus/" title="「PostgreSQL 事件總線(event bus)實作驗證」">「PostgreSQL 事件總線 (event bus) 實作驗證」</a>文章意外地在臉書引起一些負面評價。究其原因，可能是山姆鍋對於實際使用情境跟與其搭配的產品特性說明不夠清楚所導致。雖然 “I know what I’m doing”, 但為了避免該篇文章被視為誤人子弟的負面教材，只好再來平反一下。</p>
<a id="more"></a>
<p>首先，山姆鍋正在開發的軟體產品對於稽核紀錄 (auditing log) 有特別的要求，其中一個需求是使用者對資料的所有修改動作都要有對應的稽核紀錄。概念上，資料庫中資料的修改都是一種「事件 (event)」，而這樣的事件，除了產生稽核紀錄外，也有很多其它潛在用途。所以，山姆鍋選擇以非同步方式將這些事件送給其它元件來負責後續處理，其中一個便是負責產生稽核紀錄，這也是為何前篇文章中，「產生安全稽核紀錄」被列在第一項應用的原因。</p>
<p>關於事件的傳遞，如果選擇在資料庫修改交易完成後，以訊息服務 (如 RabbitMQ/Kafka) 來傳遞事件，會先面臨一個不常發生但棘手的問題：資料修改了，但事件沒送出。事件沒送出，可能是臨時的網路問題或者傳送的程序異常終止，原因不一而足。為了避開這個問題，山姆鍋選擇將事件隨同資料修改在同一個交易 (transaction) 中完成，如此，確保事件的發生被正確紀錄，且這些事件也會長期存放在資料庫中 (最終太舊的資料會被清除，但不影響這裡的論述)。但接下來的問題便是：其它需要處理這些事件的元件 (也稱為事件消費者 /consumer) 要如何即時地收到這些事件通知？如何按照事件發生的時間順序，不遺漏地處理這些事件？</p>
<p>從上面的描述可知，事件的資料已經存在資料庫中，且歷史事件也可能因為新的需求而被重新處理。在說明如何解決上述問題前，就需要先說明這個 Event bus 的設計所要支援的產品特性。這個軟體產品是針對中小型企業內部使用的系統，實際使用者是 IT 工程師，且由 IT 工程師自行安裝以及運維。所以，可以假設這個產品的同時在線使用人數不高，對多數客戶來說可能是個位數。雖然此軟體可以跑在 3 台來實現高可用需求，但在最精簡的配置，整個系統的所有服務要能夠跑在一台伺服器上。所以，自然會希望這個軟體需要的服務元件越少越好，但其中一定有的服務元件是 PostgreSQL (主資料庫)，跟 Redis (Cache)。</p>
<p>關於通知元件有新事件發生的作法，大致有考慮以下三個方案：</p>
<ol>
<li>Redis Streams</li>
<li>RabbitMQ</li>
<li>Kafka</li>
</ol>
<p>基於上述架構精簡化的原因，加上不能假設企業的 IT 工程師有能力維護一套 Kafka 系統，Kafka 很早就被排除在方案之外。Redis 的 AOF persistence (預設 fsync 時間為 1 秒) 以及 replication 並無法保證在 Redis carsh 時資料不會遺失。不過這點在這裡不是問題，因為實際的事件資料已經存在 PostgreSQL, 這裡 Redis/RabbitMQ 只是用來分發 / 通知新的事件。</p>
<p>Event consumer 一開始執行 (或者跟訊息服務斷線) 會先確認自己取得對應 subscription 的處理資格 (透過 distributed lock), 然後便是從 PostgreSQL 處理歷史資料，等到歷史資料處理完畢，才會接收新事件處理。所以，Redis Streams 跟 RabbitMQ 其實都是可行的方案，不過細心的讀者應該已經猜到山姆鍋選擇的作法：就是 Redis Streams。原因很簡單，因為產品裡已經有 Redis 了！</p>
<p>不過，為何上篇文章提到的 Event bus 沒有用 Redis Streams 而是全部使用 PostgreSQL 提供的機制？背後的原因是為了完成上面 PostgreSQL + Redis Streams 的事件處理架構，還需要有個元件 (底下稱為 Pumper) 負責將新的事件資料轉發到 Redis Streams, 而完成 Pumper 這個元件的要求就跟上篇文章中的 Event consumer 相同，需要即時知道有新事件，事件要按照時間順序處理且不能遺漏。為了備援，可能會有多個 Pumper 實例同時在執行，但同時間只能有一個在處理事件，這個可以使用 Distributed lock 來達成。至於通知，簡單的 pubsub 機制就可以實現。</p>
<p>Distributed lock 以及 Pubsub 這兩個技術要求，Redis 以及 PostgreSQL 都可以提供支援。之所以選擇使用 PostgreSQL 方案，上篇文章作為方案驗證，單純使用 PostgreSQL 實作上比較簡單，但也適用在 consumer 數量不多的情況下。所以，PostgreSQL 自始至終都是作為 Event store 的用途，Event bus 的功能確實是投機取巧 (不用白不用？)。</p>
<p>下面針對臉書上的一些反饋，山姆鍋提供一下自己的看法。</p>
<h3 id="“pg這麼用，如果只是小貓二三隻的公司內部系統當然還死不了”">“pg 這麼用，如果只是小貓二三隻的公司內部系統當然還死不了”</h3>
<p>不好意思，目標客戶真的是小貓二三隻。</p>
<h3 id="“db-master-只有一台，要-Scale-一定要-down-time”">“db master 只有一台，要 Scale 一定要 down time”</h3>
<p>Master 資料庫是這個產品的核心元件，如果主資料庫要硬體升級或者其他原因需要停機，整個服務都會停止。這跟有沒有把 PostgreSQL 作為 MQ 或者 locking server 對於可用性的結果都一樣。</p>
<h3 id="“db只用來存需要long-term-persistance的data”">“db 只用來存需要 long term persistance 的 data”</h3>
<p>前面已經說明，PostgreSQL 用來長期存放事件資料。也許有讀者會認為：這不是跟 Event sourcing 的機制很像？沒錯，只不過在這個產品，Event store/bus 並不是要支援 Event sourcing。</p>
<h3 id="“這玩法就是-outbox-pattern-的誤用啊”">“這玩法就是 outbox pattern 的誤用啊”</h3>
<p><a href="https://microservices.io/patterns/data/transactional-outbox.html" target="_blank" rel="noopener">Transactional outbox</a> 老實說是第一次聽到，雖然這樣的 Pattern 在 N 年前山姆鍋就已經知道，不過有了名稱，之後跟別人說明也比較方便了 :-)。</p>
<h2 id="小結">小結</h2>
<p>作為一個工程師，山姆鍋常常跟團隊分享：選擇適合的方案來解決問題，而不是找尋 (自認) 完美的作法。了解工具的特性、分析優缺點、根據實際的使用情境挑選適當可行方案才是務實的作法。所謂「適當」，也就是知道自己的取捨是什麼，記得不存在所謂放諸四海皆準的通則。最後，如果 “You know what you are doing”, 不用擔心跟別人意見相左。</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2022/03/airflow-as-a-scheduler/"
                    data-tooltip="以 Airflow 作為排程服務"
                    aria-label="上一篇: 以 Airflow 作為排程服務"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2022/02/postgresql-event-bus/"
                    data-tooltip="PostgreSQL 事件總線 (event bus) 實作驗證"
                    aria-label="下一篇: PostgreSQL 事件總線 (event bus) 實作驗證"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Sampot (山姆鍋). All Rights Reserved.
    </span>
    <br/>
        <a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW"><img
                alt="創用 CC 授權條款" style="border-width:0"
                src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
        除另有標示，本著作係採用<a rel="license"
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW">創用 CC
            姓名標示-非商業性-相同方式分享 4.0 國際 授權條款</a>授權。
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2022/03/airflow-as-a-scheduler/"
                    data-tooltip="以 Airflow 作為排程服務"
                    aria-label="上一篇: 以 Airflow 作為排程服務"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/post/2022/02/postgresql-event-bus/"
                    data-tooltip="PostgreSQL 事件總線 (event bus) 實作驗證"
                    aria-label="下一篇: PostgreSQL 事件總線 (event bus) 實作驗證"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/images/logo.png" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Sampot (山姆鍋)</h4>
        
            <div id="about-card-bio"><p>個人部落格， 記錄與分享一些軟體開發與運維相關資訊， 偶爾也會碎念一下</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>IT 自由工作者</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                台灣/台北
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/03/set-up-mysql-master-master-replication/"
                            aria-label=": 設定 MySQL Master-Master 複製"
                        >
                            <h3 class="media-heading">設定 MySQL Master-Master 複製</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年3月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>本文簡單說明如何設定兩台 MySQL server，讓它們彼此互相備份資料 (Master-master 模式)。雖然這樣的設定通常是支援高可用性 (high availability) 平台的一部分，但本文不包含如何完成其他 HA 的工作。設定兩台 MySQL 伺服器互相備份，主要目的就是要確認資料的安全性；同時也提高可用性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/use-pacemaker-two-node-ha-cluster/"
                            aria-label=": 使用 Pacemaker 建構雙節點叢集系統"
                        >
                            <h3 class="media-heading">使用 Pacemaker 建構雙節點叢集系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月6日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>想要達到系統高可用性 (high availability) 的需求，自然免不了需要採用現成的解決方案。本文說明如何利用 Pacemaker/heartbeat 來建構一個雙節點的從其系統。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/build-cluster-filesystem-with-glusterfs-ubuntu/"
                            aria-label=": 使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統"
                        >
                            <h3 class="media-heading">使用 GlusterFS 在 Ubuntu 上建構雙節點叢集檔案系統</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>在網站的叢集系統中，除了資料庫需要讓各個伺服器存取外，常常也會需要讓檔案 (圖檔，CSS 等等) 可以被叢集中的伺服器存取。 傳統上，常常使用 NFS 伺服器來達到此目的，但 NFS 本身往往成為單一失敗點 (single point of failure)。 本文介紹 GlusterFS 來建構一個簡單的雙節點叢集檔案系統，具備高可用性、高擴充性等特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/scale-wordpress-with-hyperdb/"
                            aria-label=": 使用 HyperDB 加強 WordPress 網站的資料庫擴充性"
                        >
                            <h3 class="media-heading">使用 HyperDB 加強 WordPress 網站的資料庫擴充性</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於流量高的 Wordpress 網站來說，資料庫往往是第一個出現的瓶頸。針對資料庫擴充性的問題，本文介紹 HyperDB 這個解決方案。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/04/create-lnmp-environment-with-nginx/"
                            aria-label=": 在 Linode 上使用 Nginx 架設 LNMP 環境"
                        >
                            <h3 class="media-heading">在 Linode 上使用 Nginx 架設 LNMP 環境</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年4月30日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Apache HTTPd 是很好的網站伺服器，但是對於 CPU 跟記憶體的要求較高，對於架設在 VPS 上面網站來說， 需要一個更輕量級的解決方案。越來越多人選擇使用 Nginx 架設網站，主要考量便是它的快速、穩定以及輕量的特性。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2012/05/support-sending-mail-php-linux-vps-exim/"
                            aria-label=": Linux VPS PHP 網站可以發送信件"
                        >
                            <h3 class="media-heading">Linux VPS PHP 網站可以發送信件</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2012年5月8日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>PHP 架站軟體通常需要用到寄信功能，例如：通知站長有新的迴響需要審核。使用虛擬主機來架站的讀者一定會納悶：<br>
不管是 WordPress，Drupal 或者其他 PHP<br>
架站軟體不是都不用另外設定就可以寄信？為什麼需要特地提到這件事情。<br>
話說山姆鍋的主機採用的是 Linode VPS，很多事情都需要自己來，唉！<br>
如果您的網站主機跟山姆鍋一樣是 VPS 或者專屬伺服器，那這篇文章也許對您有幫助。<br>
由於不是要做為公司的郵件伺服器，山姆鍋希望除了讓 PHP 架站軟體送信外，不再作其它用途。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/04/start-up/"
                            aria-label=": 影化身科技有限公司成立"
                        >
                            <h3 class="media-heading">影化身科技有限公司成立</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>2013 年 4 月 24 日，影化身科技有限公司登記成立，致力於提供雲端服務平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/shi-yong-octopresszuo-wei-bo-ke-ping-tai/"
                            aria-label=": 使用 Octopress 作為部落格平台"
                        >
                            <h3 class="media-heading">使用 Octopress 作為部落格平台</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>由於沒有需要太多動態功能，所以，嘗試使用靜態部落格平台 Octopress 來寫文章。「艾米部落」<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> 一路從 Joomla, Drupal, WordPress 到現在的 Octopress，也算是換了不少平台。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/use-static-site-generator-for-company-site/"
                            aria-label=": 使用靜態網頁產生器來管理公司網站"
                        >
                            <h3 class="media-heading">使用靜態網頁產生器來管理公司網站</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>對於不需要動態功能的網站而言，使用像是 Drupal、WordPress 之類的架站軟體，感覺有點大材小用。對於可以接受不使用「所見即所得」編輯器的人，靜態網站產生器應該是個可以接受的方案。 雖說是靜態網站，缺少很多功能，但像是公司或者行銷網站往往也不需要這些。況且， 靜態網站有諸多動態網站所沒有的功能，如：</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://samkuo.me/post/2013/05/exchange-name-card-with-eavatar-me/"
                            aria-label=": 如何利用「我．影化身」服務交換名片"
                        >
                            <h3 class="media-heading">如何利用「我．影化身」服務交換名片</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月29日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>今天從 MR JAMIE 上讀到一篇文章：「從今天開始，請 email 你的名片給我吧！」這讓我想到，與其使用 Email，使用「我．影化身」來代替，不是也很適當？</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 136 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-597bjprixrfzrennpanwcwfnulsqaw08wvkzphw7gk8dqunvgzd9nn3nvsu9.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://samkuo.me/post/2022/02/postgresql-event-bus-follow-up/';
              
            this.page.identifier = 'post/2022/02/postgresql-event-bus-follow-up/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'sampotkuo';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
      var algoliaClient = algoliasearch('OIWK4CBFS4', 'f676051199368fe5f161c9012b7edaf6');
      var algoliaIndex = algoliaClient.initIndex('MyBlogIndex');
    </script>


    </body>
</html>
